(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const so={"90's Jungle":[{name:"Glassy",url:"./assets/audio/90sjungle/glass.wav",color:"var(--color-red)"},{name:"Technique",url:"./assets/audio/90sjungle/tech.wav",color:"var(--color-ambra)"},{name:"Percs",url:"./assets/audio/90sjungle/perc.wav",color:"var(--color-green)"},{name:"Classic",url:"./assets/audio/90sjungle/classic.wav",color:"var(--color-blu)"}]},Ii=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3];function er(i,e){const t=i.numberOfChannels,n=e||i.length,r=n*t*2,o=new ArrayBuffer(44+r),c=new DataView(o);function h(I,T,S){for(let A=0;A<S.length;A++)I.setUint8(T+A,S.charCodeAt(A))}h(c,0,"RIFF"),c.setUint32(4,36+r,!0),h(c,8,"WAVE"),h(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,i.sampleRate,!0),c.setUint32(28,i.sampleRate*2*t,!0),c.setUint16(32,t*2,!0),c.setUint16(34,16,!0),h(c,36,"data"),c.setUint32(40,r,!0);const d=new Int16Array(o,44,n*t),f=[];for(let I=0;I<t;I++)f.push(i.getChannelData(I));let y=0;for(let I=0;I<n;I++)for(let T=0;T<t;T++){let S=f[T][I];S=Math.max(-1,Math.min(1,S)),d[y++]=S<0?S*32768:S*32767}return new Blob([o],{type:"audio/wav"})}function mn(i){const e=typeof i=="number"?i:50,t=44100,n=new Float32Array(t),r=Math.PI/180;for(let o=0;o<t;++o){const c=o*2/t-1;n[o]=(3+e)*c*20*r/(Math.PI+e*Math.abs(c))}return n}function za(i,e,t){const n=i.numberOfChannels,r=i.length,o=1/Math.pow(2,e),c=1/o,h=Math.floor(1/t);for(let d=0;d<n;d++){const f=i.getChannelData(d);let y=0;for(let I=0;I<r;I++){if(I%h===0){let T=f[I];T=Math.round(T*c)*o,y=T}f[I]=y}}return i}function Wa(i,e,t,n){const r=i.numberOfChannels,o=n.createBuffer(r,i.length,i.sampleRate),c=Math.floor(e*i.sampleRate),h=Math.floor(t*i.sampleRate);for(let d=0;d<r;d++){const f=i.getChannelData(d),y=o.getChannelData(d);y.set(f),h>c&&y.subarray(c,h).reverse()}return o}async function $a(i,e,t,n,r){const o=i.sampleRate,c=i.numberOfChannels,h=Math.floor(e*o),d=Math.floor(t*o),f=d-h;if(f<=0)return i;const y=new OfflineAudioContext(c,f,o),I=y.createBufferSource(),T=y.createBuffer(c,f,o);for(let D=0;D<c;D++)T.copyToChannel(i.getChannelData(D).slice(h,d),D);I.buffer=T;let S=I,A=y.destination;if(n==="distortion"){const D=y.createWaveShaper();D.curve=mn(r.amount),D.oversample="4x",S.connect(D),D.connect(A)}else if(n==="delay"){const D=y.createDelay();D.delayTime.value=r.time||.3;const x=y.createGain();x.gain.value=r.feedback||.5,S.connect(A),S.connect(D),D.connect(x),x.connect(D),D.connect(A)}else n==="bitcrush"&&S.connect(A);I.start(0);let P=await y.startRendering();n==="bitcrush"&&(P=za(P,r.bits||8,r.normFreq||.5));const R=new OfflineAudioContext(c,i.length,o).createBuffer(c,i.length,o);for(let D=0;D<c;D++){const x=R.getChannelData(D);x.set(i.getChannelData(D)),x.set(P.getChannelData(D),h)}return R}async function tr(i,e,t,n,r,o={}){return t==="reverse"?Wa(i,n,r,e):["distortion","delay","bitcrush"].includes(t)?await $a(i,n,r,t,o):i}function qa(i,e,t,n){const r=Math.floor(e*i.length),o=Math.floor(t*i.length),c=o-r;if(c<=0)return null;const h=n.createBuffer(i.numberOfChannels,c,i.sampleRate);for(let d=0;d<i.numberOfChannels;d++)h.copyToChannel(i.getChannelData(d).slice(r,o),d);return h}function Ga(){const i=document.createElement("div");return i.className="command-buttons",[{id:"play-button",icon:"pixelart-icons-font-play"},{id:"pause-button",icon:"pixelart-icons-font-pause"},{id:"stop-button",isStop:!0}].forEach(t=>{const n=document.createElement("div");n.className="old-button",n.id=t.id,t.isStop?n.innerHTML=`
      <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <rect x="6" y="6" width="15" height="15" />
      </svg>
    `:n.innerHTML=`<i class="${t.icon}"></i>`,i.appendChild(n)}),i}function hi(i,e){const t=document.createElement("div");t.className="knob-wrapper";const n=document.createElement("div");n.className="knob-label",n.innerText=e,n.id=`label-${i}`;const r=document.createElement("div");r.className="knob-body",r.id=`knob-${i}`,r.dataset.value=i==="vol"?.8:0;const o=document.createElement("div");o.className="knob-indicator";const c=i==="vol"?81:-135;o.style.transform=`translate(-50%, -100%) rotate(${c}deg)`;const h=document.createElement("div");return h.className="knob-value",h.id=`val-${i}`,h.innerText=i==="vol"?"80%":"--",r.appendChild(o),t.append(n,r,h),t}function Ka(){const i=document.createElement("div");i.className="fx-buttons-wrapper";const e=document.createElement("div");return e.className="fx-buttons",[{id:"reverse",img:"reverse.png",alt:"Reverse FX"},{id:"delay",img:"delay.png",alt:"Delay FX"},{id:"distortion",img:"distort.png",alt:"Distort FX"},{id:"bitcrush",img:"bitcrush.png",alt:"Bitcrush FX"}].forEach(n=>{const r=document.createElement("img");r.src=`./assets/img/${n.img}`,r.className="fx-img",r.draggable=!0,r.setAttribute("data-effect",n.id),r.alt=n.alt,r.addEventListener("dragstart",o=>{o.dataTransfer.setData("effectType",n.id),o.dataTransfer.effectAllowed="copy"}),e.appendChild(r)}),i.appendChild(e),i}function Xa(){const i=document.createElement("div");i.className="bpm-led-wrapper";const e=document.createElement("div");return e.id="bpm-led",e.className="bpm-led",e.innerText="tap BPM",i.appendChild(e),i}function Ja(){const i=document.createElement("div");i.className="sampler-wrapper";const e=document.createElement("div");e.className="sampler border-shadow",e.id="sample-drop";const t=document.createElement("div");t.id="waveform";const n=document.createElement("div");n.className="plus-wrapper",n.id="plus-wrapper",n.innerText="DROP A SAMPLE...",t.appendChild(n);const r=document.createElement("div");r.className="eq-grid",r.appendChild(Qa()),e.append(t,r);const o=document.createElement("div");o.className="commands border-shadow";const c=document.createElement("div");c.className="loop-label",c.innerText="PLAYBACK";const h=Ga(),d=document.createElement("div");d.className="loop-label",d.innerText="LOOP";const f=document.createElement("div");f.className="loop-buttons",[{id:"d2-button",icon:"pixelart-icons-font-prev"},{id:"loop-button",icon:"pixelart-icons-font-reload"},{id:"x2-button",icon:"pixelart-icons-font-next"}].forEach(R=>{const D=document.createElement("div");D.className="old-button",D.id=R.id,D.innerHTML=`<i class="${R.icon}"></i>`,f.appendChild(D)});const I=document.createElement("div");I.className="loop-label",I.innerText="UTILS";const T=document.createElement("div");T.className="rec-buttons";const S=document.createElement("div");S.className="old-button",S.id="snap-btn",S.title="Snap to Grid",S.innerHTML=`
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="display: block;">
      <rect x="5" y="4" width="4" height="4" />
      <rect x="5" y="10" width="4" height="5" />

      <rect x="15" y="4" width="4" height="4" />
      <rect x="15" y="10" width="4" height="5" />
      
      <rect x="5" y="15" width="5" height="2" />
      <rect x="14" y="15" width="5" height="2" />
      
      <rect x="7" y="17" width="10" height="2" />
      
      <rect x="9" y="19" width="6" height="1" />
    </svg>
  `;const A=document.createElement("div");A.className="old-button",A.id="trim-btn",A.title="Trim Audio",A.innerHTML='<i class="pixelart-icons-font-cut"></i>';const P=document.createElement("div");return P.className="old-button",P.id="export-btn",P.title="Export to WAV",P.innerHTML='<i class="pixelart-icons-font-download"></i>',T.append(S,A,P),o.append(c,h,d,f,I,T),i.append(e,o),i}function Ya(){const i=document.createElement("div");i.className="effects border-shadow";const e=document.createElement("div");e.className="fx-label",e.textContent="EFFECTS";const t=Ka(),n=document.createElement("div");n.className="knobs-rack hidden",n.id="knobs-rack",n.appendChild(hi("p1","PARAM 1")),n.appendChild(hi("p2","PARAM 2")),n.appendChild(hi("vol","FX LEVEL"));const r=Xa();return i.append(e,t,n,r),i}function Za(){const i=document.createElement("div");i.className="banks border-shadow";const e=document.createElement("div");e.className="banks-menu";const t=document.createElement("div");t.className="banks-label",t.innerText="CHOOSE A SOUNDBANK";const n=document.createElement("select");n.name="banks",n.id="banks",n.className="banks-dropdown",n.addEventListener("change",o=>{tc(o.target.value)}),e.append(t,n);const r=document.createElement("div");return r.className="banks-content",i.append(e,r),i}function Qa(){const i=document.createElement("div");return i.id="sliders-wrapper",i.className="sliders-wrapper",Ii.map(e=>{const t=document.createElement("div");t.classList.add("eq-band");const n=document.createElement("input");n.classList.add("slider-eq"),n.type="range",n.min=-12,n.max=12,n.value=0,n.step=.1,n.addEventListener("dblclick",()=>{n.value=0,n.dispatchEvent(new Event("input"))});const r=document.createElement("div");t.classList.add("eq-label"),r.textContent=ec(e),t.appendChild(n),t.appendChild(r),i.appendChild(t)}),i}function ec(i){return i>=1e3?`${i/1e3}kHz`:`${i} Hz`}function tc(i){const e=document.querySelector(".banks-content");if(!e||(e.innerHTML="",!i))return;const t=so[i];t&&t.forEach(n=>{const r=document.createElement("div");r.classList.add("sample-pad"),r.textContent=n.name,r.style.borderBottom=`4px solid ${n.color}`,r.draggable=!0,r.addEventListener("dragstart",o=>{o.dataTransfer.setData("type","sample"),o.dataTransfer.setData("audioUrl",n.url),o.dataTransfer.effectAllowed="copy"}),e.appendChild(r)})}function nc(){const i=document.getElementById("banks");if(!i)return;i.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="-- SELECT SOUND BANK --",e.disabled=!0,e.selected=!0,e.hidden=!0,i.appendChild(e),Object.keys(so).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,i.appendChild(n)})}function ic(){const i=document.createElement("div");i.className="wrapper",i.appendChild(Ja()),i.appendChild(Ya()),i.appendChild(Za());const e=document.getElementById("root")||document.body;e.innerHTML="",e.appendChild(i),nc()}function ee(i,e,t,n){return new(t||(t=Promise))((function(r,o){function c(f){try{d(n.next(f))}catch(y){o(y)}}function h(f){try{d(n.throw(f))}catch(y){o(y)}}function d(f){var y;f.done?r(f.value):(y=f.value,y instanceof t?y:new t((function(I){I(y)}))).then(c,h)}d((n=n.apply(i,e||[])).next())}))}let zt=class{constructor(){this.listeners={}}on(e,t,n){if(this.listeners[e]||(this.listeners[e]=new Set),n?.once){const r=(...o)=>{this.un(e,r),t(...o)};return this.listeners[e].add(r),()=>this.un(e,r)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var n;(n=this.listeners[e])===null||n===void 0||n.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((n=>n(...t)))}};const hn={decode:function(i,e){return ee(this,void 0,void 0,(function*(){const t=new AudioContext({sampleRate:e});try{return yield t.decodeAudioData(i)}finally{t.close()}}))},createBuffer:function(i,e){if(!i||i.length===0)throw new Error("channelData must be a non-empty array");if(e<=0)throw new Error("duration must be greater than 0");if(typeof i[0]=="number"&&(i=[i]),!i[0]||i[0].length===0)throw new Error("channelData must contain non-empty channel arrays");(function(n){const r=n[0];if(r.some((o=>o>1||o<-1))){const o=r.length;let c=0;for(let h=0;h<o;h++){const d=Math.abs(r[h]);d>c&&(c=d)}for(const h of n)for(let d=0;d<o;d++)h[d]/=c}})(i);const t=i.map((n=>n instanceof Float32Array?n:Float32Array.from(n)));return{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:n=>{const r=t[n];if(!r)throw new Error(`Channel ${n} not found`);return r},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function ro(i,e){const t=e.xmlns?document.createElementNS(e.xmlns,i):document.createElement(i);for(const[n,r]of Object.entries(e))if(n==="children"&&r)for(const[o,c]of Object.entries(r))c instanceof Node?t.appendChild(c):typeof c=="string"?t.appendChild(document.createTextNode(c)):t.appendChild(ro(o,c));else n==="style"?Object.assign(t.style,r):n==="textContent"?t.textContent=r:t.setAttribute(n,r.toString());return t}function nr(i,e,t){const n=ro(i,e||{});return t?.appendChild(n),n}var sc=Object.freeze({__proto__:null,createElement:nr,default:nr});const rc={fetchBlob:function(i,e,t){return ee(this,void 0,void 0,(function*(){const n=yield fetch(i,t);if(n.status>=400)throw new Error(`Failed to fetch ${i}: ${n.status} (${n.statusText})`);return(function(r,o){ee(this,void 0,void 0,(function*(){if(!r.body||!r.headers)return;const c=r.body.getReader(),h=Number(r.headers.get("Content-Length"))||0;let d=0;const f=y=>{d+=y?.length||0;const I=Math.round(d/h*100);o(I)};try{for(;;){const y=yield c.read();if(y.done)break;f(y.value)}}catch(y){console.warn("Progress tracking error:",y)}}))})(n.clone(),e),n.blob()}))}};class oc extends zt{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",(()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)}),{once:!0})}onMediaEvent(e,t,n){return this.media.addEventListener(e,t,n),()=>this.media.removeEventListener(e,t,n)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,t){const n=this.getSrc();if(e&&n===e)return;this.revokeSrc();const r=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;if(n&&this.media.removeAttribute("src"),r||e)try{this.media.src=r}catch{this.media.src=e}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(e){this.media=e}play(){return ee(this,void 0,void 0,(function*(){try{return yield this.media.play()}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;throw e}}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}function ui(i){return i<0?0:i>1?1:i}function ac({maxTop:i,maxBottom:e,halfHeight:t,vScale:n}){const r=Math.round(i*t*n);return{topHeight:r,totalHeight:r+Math.round(e*t*n)||1}}function cc({barAlign:i,halfHeight:e,topHeight:t,totalHeight:n,canvasHeight:r}){return i==="top"?0:i==="bottom"?r-n:e-t}function ir(i,e,t){const n=e-i.left,r=t-i.top;return[n/i.width,r/i.height]}function oo(i){return!!(i.barWidth||i.barGap||i.barAlign)}function sr(i,e){if(!oo(e))return i;const t=e.barWidth||.5,n=t+(e.barGap||t/2);return n===0?i:Math.floor(i/n)*n}function rr({scrollLeft:i,totalWidth:e,numCanvases:t}){if(e===0)return[0];const n=i/e,r=Math.floor(n*t);return[r-1,r,r+1]}function or({scrollLeft:i,clientWidth:e,scrollWidth:t}){return t===0?{startX:0,endX:0}:{startX:i/t,endX:(i+e)/t}}class lc extends zt{constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=e;const n=this.parentFromOptionsContainer(e.container);this.parent=n;const[r,o]=this.initHtml();n.appendChild(r),this.container=r,this.scrollContainer=o.querySelector(".scroll"),this.wrapper=o.querySelector(".wrapper"),this.canvasWrapper=o.querySelector(".canvases"),this.progressWrapper=o.querySelector(".progress"),this.cursor=o.querySelector(".cursor"),t&&o.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){if(this.wrapper.addEventListener("click",(e=>{const t=this.wrapper.getBoundingClientRect(),[n,r]=ir(t,e.clientX,e.clientY);this.emit("click",n,r)})),this.wrapper.addEventListener("dblclick",(e=>{const t=this.wrapper.getBoundingClientRect(),[n,r]=ir(t,e.clientX,e.clientY);this.emit("dblclick",n,r)})),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:e,scrollWidth:t,clientWidth:n}=this.scrollContainer,{startX:r,endX:o}=or({scrollLeft:e,scrollWidth:t,clientWidth:n});this.emit("scroll",r,o,e,e+n)})),typeof ResizeObserver=="function"){const e=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{e().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=(function(e,t,n,r,o=3,c=0,h=100){if(!e)return()=>{};const d=new Map,f=matchMedia("(pointer: coarse)").matches;let y=()=>{};const I=T=>{if(T.button!==c||(d.set(T.pointerId,T),d.size>1))return;let S=T.clientX,A=T.clientY,P=!1;const R=Date.now(),D=N=>{if(N.defaultPrevented||d.size>1||f&&Date.now()-R<h)return;const v=N.clientX,p=N.clientY,g=v-S,w=p-A;if(P||Math.abs(g)>o||Math.abs(w)>o){N.preventDefault(),N.stopPropagation();const _=e.getBoundingClientRect(),{left:b,top:m}=_;P||(n?.(S-b,A-m),P=!0),t(g,w,v-b,p-m),S=v,A=p}},x=N=>{if(d.delete(N.pointerId),P){const v=N.clientX,p=N.clientY,g=e.getBoundingClientRect(),{left:w,top:_}=g;r?.(v-w,p-_)}y()},U=N=>{d.delete(N.pointerId),N.relatedTarget&&N.relatedTarget!==document.documentElement||x(N)},B=N=>{P&&(N.stopPropagation(),N.preventDefault())},O=N=>{N.defaultPrevented||d.size>1||P&&N.preventDefault()};document.addEventListener("pointermove",D),document.addEventListener("pointerup",x),document.addEventListener("pointerout",U),document.addEventListener("pointercancel",U),document.addEventListener("touchmove",O,{passive:!1}),document.addEventListener("click",B,{capture:!0}),y=()=>{document.removeEventListener("pointermove",D),document.removeEventListener("pointerup",x),document.removeEventListener("pointerout",U),document.removeEventListener("pointercancel",U),document.removeEventListener("touchmove",O),setTimeout((()=>{document.removeEventListener("click",B,{capture:!0})}),10)}};return e.addEventListener("pointerdown",I),()=>{y(),e.removeEventListener("pointerdown",I),d.clear()}})(this.wrapper,((e,t,n)=>{const r=this.wrapper.getBoundingClientRect().width;this.emit("drag",ui(n/r))}),(e=>{this.isDragging=!0;const t=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",ui(e/t))}),(e=>{this.isDragging=!1;const t=this.wrapper.getBoundingClientRect().width;this.emit("dragend",ui(e/t))})),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),n=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${n?` nonce="${n}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:t}=this.scrollContainer,n=t*e;this.setScroll(n)}destroy(){var e;this.subscriptions.forEach((t=>t())),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),(e=this.unsubscribeOnScroll)===null||e===void 0||e.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(e=10){let t,n;const r=()=>{t&&(clearTimeout(t),t=void 0),n&&(n(),n=void 0)};return this.timeouts.push(r),()=>new Promise(((o,c)=>{r(),n=c,t=setTimeout((()=>{t=void 0,n=void 0,o()}),e)}))}getHeight(e,t){var n;const r=((n=this.audioData)===null||n===void 0?void 0:n.numberOfChannels)||1;return(function({optionsHeight:o,optionsSplitChannels:c,parentHeight:h,numberOfChannels:d,defaultHeight:f=128}){if(o==null)return f;const y=Number(o);if(!isNaN(y))return y;if(o==="auto"){const I=h||f;return c?.every((T=>!T.overlay))?I/d:I}return f})({optionsHeight:e,optionsSplitChannels:t,parentHeight:this.parent.clientHeight,numberOfChannels:r,defaultHeight:128})}convertColorValues(e){return(function(t,n){if(!Array.isArray(t))return t||"";if(t.length===0)return"#999";if(t.length<2)return t[0]||"";const r=document.createElement("canvas"),o=r.getContext("2d"),c=r.height*n,h=o.createLinearGradient(0,0,0,c||n),d=1/(t.length-1);return t.forEach(((f,y)=>{h.addColorStop(y*d,f)})),h})(e,this.getPixelRatio())}getPixelRatio(){return e=window.devicePixelRatio,Math.max(1,e||1);var e}renderBarWaveform(e,t,n,r){const{width:o,height:c}=n.canvas,{halfHeight:h,barWidth:d,barRadius:f,barIndexScale:y,barSpacing:I}=(function({width:S,height:A,length:P,options:R,pixelRatio:D}){const x=A/2,U=R.barWidth?R.barWidth*D:1,B=R.barGap?R.barGap*D:R.barWidth?U/2:0,O=U+B||1;return{halfHeight:x,barWidth:U,barGap:B,barRadius:R.barRadius||0,barIndexScale:P>0?S/O/P:0,barSpacing:O}})({width:o,height:c,length:(e[0]||[]).length,options:t,pixelRatio:this.getPixelRatio()}),T=(function({channelData:S,barIndexScale:A,barSpacing:P,barWidth:R,halfHeight:D,vScale:x,canvasHeight:U,barAlign:B}){const O=S[0]||[],N=S[1]||O,v=O.length,p=[];let g=0,w=0,_=0;for(let b=0;b<=v;b++){const m=Math.round(b*A);if(m>g){const{topHeight:Un,totalHeight:Yt}=ac({maxTop:w,maxBottom:_,halfHeight:D,vScale:x}),it=cc({barAlign:B,halfHeight:D,topHeight:Un,totalHeight:Yt,canvasHeight:U});p.push({x:g*P,y:it,width:R,height:Yt}),g=m,w=0,_=0}const X=Math.abs(O[b]||0),ce=Math.abs(N[b]||0);X>w&&(w=X),ce>_&&(_=ce)}return p})({channelData:e,barIndexScale:y,barSpacing:I,barWidth:d,halfHeight:h,vScale:r,canvasHeight:c,barAlign:t.barAlign});n.beginPath();for(const S of T)f&&"roundRect"in n?n.roundRect(S.x,S.y,S.width,S.height,f):n.rect(S.x,S.y,S.width,S.height);n.fill(),n.closePath()}renderLineWaveform(e,t,n,r){const{width:o,height:c}=n.canvas,h=(function({channelData:d,width:f,height:y,vScale:I}){const T=y/2,S=d[0]||[];return[S,d[1]||S].map(((A,P)=>{const R=A.length,D=R?f/R:0,x=T,U=P===0?-1:1,B=[{x:0,y:x}];let O=0,N=0;for(let v=0;v<=R;v++){const p=Math.round(v*D);if(p>O){const w=x+(Math.round(N*T*I)||1)*U;B.push({x:O,y:w}),O=p,N=0}const g=Math.abs(A[v]||0);g>N&&(N=g)}return B.push({x:O,y:x}),B}))})({channelData:e,width:o,height:c,vScale:r});n.beginPath();for(const d of h)if(d.length){n.moveTo(d[0].x,d[0].y);for(let f=1;f<d.length;f++){const y=d[f];n.lineTo(y.x,y.y)}}n.fill(),n.closePath()}renderWaveform(e,t,n){if(n.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(e,n);const r=(function({channelData:o,barHeight:c,normalize:h}){var d;const f=c||1;if(!h)return f;const y=o[0];if(!y||y.length===0)return f;let I=0;for(let T=0;T<y.length;T++){const S=(d=y[T])!==null&&d!==void 0?d:0,A=Math.abs(S);A>I&&(I=A)}return I?f/I:f})({channelData:e,barHeight:t.barHeight,normalize:t.normalize});oo(t)?this.renderBarWaveform(e,t,n,r):this.renderLineWaveform(e,t,n,r)}renderSingleCanvas(e,t,n,r,o,c,h){const d=this.getPixelRatio(),f=document.createElement("canvas");f.width=Math.round(n*d),f.height=Math.round(r*d),f.style.width=`${n}px`,f.style.height=`${r}px`,f.style.left=`${Math.round(o)}px`,c.appendChild(f);const y=f.getContext("2d");if(t.renderFunction?(y.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction(e,y)):this.renderWaveform(e,t,y),f.width>0&&f.height>0){const I=f.cloneNode(),T=I.getContext("2d");T.drawImage(f,0,0),T.globalCompositeOperation="source-in",T.fillStyle=this.convertColorValues(t.progressColor),T.fillRect(0,0,f.width,f.height),h.appendChild(I)}}renderMultiCanvas(e,t,n,r,o,c){const h=this.getPixelRatio(),{clientWidth:d}=this.scrollContainer,f=n/h,y=(function({clientWidth:A,totalWidth:P,options:R}){return sr(Math.min(8e3,A,P),R)})({clientWidth:d,totalWidth:f,options:t});let I={};if(y===0)return;const T=A=>{if(A<0||A>=S||I[A])return;I[A]=!0;const P=A*y;let R=Math.min(f-P,y);if(R=sr(R,t),R<=0)return;const D=(function({channelData:x,offset:U,clampedWidth:B,totalWidth:O}){return x.map((N=>{const v=Math.floor(U/O*N.length),p=Math.floor((U+B)/O*N.length);return N.slice(v,p)}))})({channelData:e,offset:P,clampedWidth:R,totalWidth:f});this.renderSingleCanvas(D,t,R,r,P,o,c)},S=Math.ceil(f/y);if(!this.isScrollable){for(let A=0;A<S;A++)T(A);return}if(rr({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:f,numCanvases:S}).forEach((A=>T(A))),S>1){const A=this.on("scroll",(()=>{const{scrollLeft:P}=this.scrollContainer;Object.keys(I).length>10&&(o.innerHTML="",c.innerHTML="",I={}),rr({scrollLeft:P,totalWidth:f,numCanvases:S}).forEach((R=>T(R)))}));this.unsubscribeOnScroll.push(A)}}renderChannel(e,t,n,r){var{overlay:o}=t,c=(function(y,I){var T={};for(var S in y)Object.prototype.hasOwnProperty.call(y,S)&&I.indexOf(S)<0&&(T[S]=y[S]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function"){var A=0;for(S=Object.getOwnPropertySymbols(y);A<S.length;A++)I.indexOf(S[A])<0&&Object.prototype.propertyIsEnumerable.call(y,S[A])&&(T[S[A]]=y[S[A]])}return T})(t,["overlay"]);const h=document.createElement("div"),d=this.getHeight(c.height,c.splitChannels);h.style.height=`${d}px`,o&&r>0&&(h.style.marginTop=`-${d}px`),this.canvasWrapper.style.minHeight=`${d}px`,this.canvasWrapper.appendChild(h);const f=h.cloneNode();this.progressWrapper.appendChild(f),this.renderMultiCanvas(e,c,n,d,h,f)}render(e){return ee(this,void 0,void 0,(function*(){var t;this.timeouts.forEach((f=>f())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const n=this.getPixelRatio(),r=this.scrollContainer.clientWidth,{scrollWidth:o,isScrollable:c,useParentWidth:h,width:d}=(function({duration:f,minPxPerSec:y=0,parentWidth:I,fillParent:T,pixelRatio:S}){const A=Math.ceil(f*y),P=A>I,R=!!(T&&!P);return{scrollWidth:A,isScrollable:P,useParentWidth:R,width:(R?I:A)*S}})({duration:e.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:r,fillParent:this.options.fillParent,pixelRatio:n});if(this.isScrollable=c,this.wrapper.style.width=h?"100%":`${o}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let f=0;f<e.numberOfChannels;f++){const y=Object.assign(Object.assign({},this.options),(t=this.options.splitChannels)===null||t===void 0?void 0:t[f]);this.renderChannel([e.getChannelData(f)],y,d,f)}else{const f=[e.getChannelData(0)];e.numberOfChannels>1&&f.push(e.getChannelData(1)),this.renderChannel(f,this.options,d,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((n=>n())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:n}=this.progressWrapper.getBoundingClientRect(),r=(function(o){const c=2*o;return(c<0?Math.floor(c):Math.ceil(c))/2})(n-t);this.scrollContainer.scrollLeft+=r}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{scrollLeft:n,scrollWidth:r,clientWidth:o}=this.scrollContainer,c=e*r,h=n,d=n+o,f=o/2;if(this.isDragging)c+30>d?this.scrollContainer.scrollLeft+=30:c-30<h&&(this.scrollContainer.scrollLeft-=30);else{(c<h||c>d)&&(this.scrollContainer.scrollLeft=c-(this.options.autoCenter?f:0));const y=c-n-f;t&&this.options.autoCenter&&y>0&&(this.scrollContainer.scrollLeft+=y)}{const y=this.scrollContainer.scrollLeft,{startX:I,endX:T}=or({scrollLeft:y,scrollWidth:r,clientWidth:o});this.emit("scroll",I,T,y,y+o)}}renderProgress(e,t){if(isNaN(e))return;const n=100*e;this.canvasWrapper.style.clipPath=`polygon(${n}% 0%, 100% 0%, 100% 100%, ${n}% 100%)`,this.progressWrapper.style.width=`${n}%`,this.cursor.style.left=`${n}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${e*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,t)}exportImage(e,t,n){return ee(this,void 0,void 0,(function*(){const r=this.canvasWrapper.querySelectorAll("canvas");if(!r.length)throw new Error("No waveform data");if(n==="dataURL"){const o=Array.from(r).map((c=>c.toDataURL(e,t)));return Promise.resolve(o)}return Promise.all(Array.from(r).map((o=>new Promise(((c,h)=>{o.toBlob((d=>{d?c(d):h(new Error("Could not export image"))}),e,t)})))))}))}}class hc extends zt{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const e=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(e))};e()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class di extends zt{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return ee(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then((t=>{if(t.status>=400)throw new Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()})).then((t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t))).then((t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})).catch((t=>{console.error("WebAudioPlayer load error:",t)}))}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return ee(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){const t=e-this.currentTime,n=this.bufferNode;n?.stop(this.audioContext.currentTime+t),n?.addEventListener("ended",(()=>{n===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(e){return ee(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(e)}))}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return(e=this._duration)!==null&&e!==void 0?e:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const t=this.buffer.numberOfChannels;for(let n=0;n<t;n++)e.push(this.buffer.getChannelData(n));return e}removeAttribute(e){switch(e){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const uc={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class Ft extends oc{static create(e){return new Ft(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new di:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},uc,e),this.timer=new hc;const n=t?void 0:this.getMediaElement();this.renderer=new lc(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const r=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:o,duration:c}=this.options;(r||o&&c)&&this.load(r,o,c).catch((h=>{this.emit("error",h instanceof Error?h:new Error(String(h)))}))}))}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),this.stopAtPosition!=null&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const e=this.updateProgress();this.emit("timeupdate",e)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var e;this.emit("error",(e=this.getMediaElement().error)!==null&&e!==void 0?e:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))})),this.renderer.on("dblclick",((e,t)=>{this.emit("dblclick",e,t)})),this.renderer.on("scroll",((e,t,n,r)=>{const o=this.getDuration();this.emit("scroll",e*o,t*o,n,r)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(e=>{this.emit("dragstart",e)})),this.renderer.on("dragend",(e=>{this.emit("dragend",e)})),this.renderer.on("resize",(()=>{this.emit("resize")})));{let e;const t=this.renderer.on("drag",(n=>{var r;if(!this.options.interact)return;this.renderer.renderProgress(n),clearTimeout(e);let o=0;const c=this.options.dragToSeek;this.isPlaying()?o=0:c===!0?o=200:c&&typeof c=="object"&&(o=(r=c.debounceTime)!==null&&r!==void 0?r:200),e=setTimeout((()=>{this.seekTo(n)}),o),this.emit("interaction",n*this.getDuration()),this.emit("drag",n)}));this.subscriptions.push((()=>{clearTimeout(e),t()}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((e=>e())),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=hn.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=hn.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){if(this.plugins.includes(e))return e;e._init(this),this.plugins.push(e);const t=e.once("destroy",(()=>{this.plugins=this.plugins.filter((n=>n!==e)),this.subscriptions=this.subscriptions.filter((n=>n!==t))}));return this.subscriptions.push(t),e}unregisterPlugin(e){this.plugins=this.plugins.filter((t=>t!==e)),e.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){const t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,n,r){return ee(this,void 0,void 0,(function*(){var o;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,(o=this.abortController)===null||o===void 0||o.abort(),this.abortController=null,!t&&!n){const h=this.options.fetchParams||{};window.AbortController&&!h.signal&&(this.abortController=new AbortController,h.signal=this.abortController.signal);const d=y=>this.emit("loading",y);t=yield rc.fetchBlob(e,d,h);const f=this.options.blobMimeType;f&&(t=new Blob([t],{type:f}))}this.setSrc(e,t);const c=yield new Promise((h=>{const d=r||this.getDuration();d?h(d):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>h(this.getDuration())),{once:!0}))}));if(!e&&!t){const h=this.getMediaElement();h instanceof di&&(h.duration=c)}if(n)this.decodedData=hn.createBuffer(n,c||0);else if(t){const h=yield t.arrayBuffer();this.decodedData=yield hn.decode(h,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(e,t,n){return ee(this,void 0,void 0,(function*(){try{return yield this.loadAudio(e,void 0,t,n)}catch(r){throw this.emit("error",r),r}}))}loadBlob(e,t,n){return ee(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",e,t,n)}catch(r){throw this.emit("error",r),r}}))}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:n=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const r=Math.min(e,this.decodedData.numberOfChannels),o=[];for(let c=0;c<r;c++){const h=this.decodedData.getChannelData(c),d=[],f=h.length/t;for(let y=0;y<t;y++){const I=h.slice(Math.floor(y*f),Math.ceil((y+1)*f));let T=0;for(let S=0;S<I.length;S++){const A=I[S];Math.abs(A)>Math.abs(T)&&(T=A)}d.push(Math.round(T*n)/n)}o.push(d)}return o}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}play(e,t){const n=Object.create(null,{play:{get:()=>super.play}});return ee(this,void 0,void 0,(function*(){e!=null&&this.setTime(e);const r=yield n.play.call(this);return t!=null&&(this.media instanceof di?this.media.stopAt(t):this.stopAtPosition=t),r}))}playPause(){return ee(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return ee(this,arguments,void 0,(function*(e="image/png",t=1,n="dataURL"){return this.renderer.exportImage(e,t,n)}))}destroy(){var e;this.emit("destroy"),(e=this.abortController)===null||e===void 0||e.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}Ft.BasePlugin=class extends zt{constructor(i){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=i}onInit(){}_init(i){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=i,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((i=>i())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},Ft.dom=sc;class ao{constructor(){this.listeners={}}on(e,t,n){if(this.listeners[e]||(this.listeners[e]=new Set),n?.once){const r=(...o)=>{this.un(e,r),t(...o)};return this.listeners[e].add(r),()=>this.un(e,r)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var n;(n=this.listeners[e])===null||n===void 0||n.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((n=>n(...t)))}}class dc extends ao{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((e=>e())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function yn(i,e,t,n,r=3,o=0,c=100){if(!i)return()=>{};const h=new Map,d=matchMedia("(pointer: coarse)").matches;let f=()=>{};const y=I=>{if(I.button!==o||(h.set(I.pointerId,I),h.size>1))return;let T=I.clientX,S=I.clientY,A=!1;const P=Date.now(),R=O=>{if(O.defaultPrevented||h.size>1||d&&Date.now()-P<c)return;const N=O.clientX,v=O.clientY,p=N-T,g=v-S;if(A||Math.abs(p)>r||Math.abs(g)>r){O.preventDefault(),O.stopPropagation();const w=i.getBoundingClientRect(),{left:_,top:b}=w;A||(t?.(T-_,S-b),A=!0),e(p,g,N-_,v-b),T=N,S=v}},D=O=>{if(h.delete(O.pointerId),A){const N=O.clientX,v=O.clientY,p=i.getBoundingClientRect(),{left:g,top:w}=p;n?.(N-g,v-w)}f()},x=O=>{h.delete(O.pointerId),O.relatedTarget&&O.relatedTarget!==document.documentElement||D(O)},U=O=>{A&&(O.stopPropagation(),O.preventDefault())},B=O=>{O.defaultPrevented||h.size>1||A&&O.preventDefault()};document.addEventListener("pointermove",R),document.addEventListener("pointerup",D),document.addEventListener("pointerout",x),document.addEventListener("pointercancel",x),document.addEventListener("touchmove",B,{passive:!1}),document.addEventListener("click",U,{capture:!0}),f=()=>{document.removeEventListener("pointermove",R),document.removeEventListener("pointerup",D),document.removeEventListener("pointerout",x),document.removeEventListener("pointercancel",x),document.removeEventListener("touchmove",B),setTimeout((()=>{document.removeEventListener("click",U,{capture:!0})}),10)}};return i.addEventListener("pointerdown",y),()=>{f(),i.removeEventListener("pointerdown",y),h.clear()}}function co(i,e){const t=e.xmlns?document.createElementNS(e.xmlns,i):document.createElement(i);for(const[n,r]of Object.entries(e))if(n==="children"&&r)for(const[o,c]of Object.entries(r))c instanceof Node?t.appendChild(c):typeof c=="string"?t.appendChild(document.createTextNode(c)):t.appendChild(co(o,c));else n==="style"?Object.assign(t.style,r):n==="textContent"?t.textContent=r:t.setAttribute(n,r.toString());return t}function Ot(i,e,t){const n=co(i,e||{});return t?.appendChild(n),n}class ar extends ao{constructor(e,t,n=0){var r,o,c,h,d,f,y,I,T,S;super(),this.totalDuration=t,this.numberOfChannels=n,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.updatingSide=void 0,this.isRemoved=!1,this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((r=e.end)!==null&&r!==void 0?r:e.start),this.drag=(o=e.drag)===null||o===void 0||o,this.resize=(c=e.resize)===null||c===void 0||c,this.resizeStart=(h=e.resizeStart)===null||h===void 0||h,this.resizeEnd=(d=e.resizeEnd)===null||d===void 0||d,this.color=(f=e.color)!==null&&f!==void 0?f:"rgba(0, 0, 0, 0.1)",this.minLength=(y=e.minLength)!==null&&y!==void 0?y:this.minLength,this.maxLength=(I=e.maxLength)!==null&&I!==void 0?I:this.maxLength,this.channelIdx=(T=e.channelIdx)!==null&&T!==void 0?T:-1,this.contentEditable=(S=e.contentEditable)!==null&&S!==void 0?S:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;const t=this.start===this.end;(e=this.element)===null||e===void 0||e.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},n=Ot("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),r=Ot("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);this.subscriptions.push(yn(n,(o=>this.onResize(o,"start")),(()=>null),(()=>this.onEndResizing("start")),1),yn(r,(o=>this.onResize(o,"end")),(()=>null),(()=>this.onEndResizing("end")),1))}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),n=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),n&&e.removeChild(n)}initElement(){if(this.isRemoved)return null;const e=this.start===this.end;let t=0,n=100;this.channelIdx>=0&&this.numberOfChannels>0&&this.channelIdx<this.numberOfChannels&&(n=100/this.numberOfChannels,t=n*this.channelIdx);const r=Ot("div",{style:{position:"absolute",top:`${t}%`,height:`${n}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(r),r}renderPosition(){if(!this.element)return;const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",(t=>this.emit("click",t))),e.addEventListener("mouseenter",(t=>this.emit("over",t))),e.addEventListener("mouseleave",(t=>this.emit("leave",t))),e.addEventListener("dblclick",(t=>this.emit("dblclick",t))),e.addEventListener("pointerdown",(()=>this.toggleCursor(!0))),e.addEventListener("pointerup",(()=>this.toggleCursor(!1))),this.subscriptions.push(yn(e,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}))),this.contentEditable&&this.content&&(this.contentClickListener=t=>this.onContentClick(t),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)))}_onUpdate(e,t,n){var r;if(!(!((r=this.element)===null||r===void 0)&&r.parentElement))return;const{width:o}=this.element.parentElement.getBoundingClientRect(),c=e/o*this.totalDuration;let h=t&&t!=="start"?this.start:this.start+c,d=t&&t!=="end"?this.end:this.end+c;const f=n!==void 0;f&&this.updatingSide&&this.updatingSide!==t&&(this.updatingSide==="start"?h=n:d=n),h=Math.max(0,h),d=Math.min(this.totalDuration,d);const y=d-h;this.updatingSide=t;const I=y>=this.minLength&&y<=this.maxLength;h<=d&&(I||f)&&(this.start=h,this.end=d,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||t!=="start")&&(this.resizeEnd||t!=="end")&&this._onUpdate(e,t)}onEndResizing(e){this.resize&&(this.emit("update-end",e),this.updatingSide=void 0)}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(e=!1){var t;return e?this.content||void 0:this.element instanceof HTMLElement?((t=this.content)===null||t===void 0?void 0:t.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if(this.content&&this.contentEditable&&(this.contentClickListener&&this.content.removeEventListener("click",this.contentClickListener),this.contentBlurListener&&this.content.removeEventListener("blur",this.contentBlurListener)),(t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){const n=this.start===this.end;this.content=Ot("div",{style:{padding:`0.2em ${n?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true",this.contentClickListener=n=>this.onContentClick(n),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,n;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const r=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((n=e.end)!==null&&n!==void 0?n:r?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const r=this.start===this.end;this.resize=e.resize,this.resize&&!r?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}e.resizeStart!==void 0&&(this.resizeStart=e.resizeStart),e.resizeEnd!==void 0&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach((e=>e())),this.element&&(this.element.remove(),this.element=null)}}class Oi extends dc{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new Oi(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer),this.subscriptions.push(this.wavesurfer.on("ready",(t=>{this.regions.forEach((n=>n._setTotalDuration(t)))})));let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",(t=>{const n=this.regions.filter((r=>r.start<=t&&(r.end===r.start?r.start+.05:r.end)>=t));n.forEach((r=>{e.includes(r)||this.emit("region-in",r)})),e.forEach((r=>{n.includes(r)||this.emit("region-out",r)})),e=n})))}initRegionsContainer(){return Ot("div",{part:"regions-container",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout((()=>{const t=e.content,n=t.getBoundingClientRect(),r=this.regions.map((o=>{if(o===e||!o.content)return 0;const c=o.content.getBoundingClientRect();return n.left<c.left+c.width&&c.left<n.left+n.width?c.height:0})).reduce(((o,c)=>o+c),0);t.style.marginTop=`${r}px`}),10)}adjustScroll(e){var t,n;if(!e.element)return;const r=(n=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||n===void 0?void 0:n.parentElement;if(!r)return;const{clientWidth:o,scrollWidth:c}=r;if(c<=o)return;const h=r.getBoundingClientRect(),d=e.element.getBoundingClientRect(),f=d.left-h.left,y=d.right-h.left;f<0?r.scrollLeft+=f:y>o&&(r.scrollLeft+=y-o)}virtualAppend(e,t,n){const r=()=>{if(!this.wavesurfer)return;const o=this.wavesurfer.getWidth(),c=this.wavesurfer.getScroll(),h=t.clientWidth,d=this.wavesurfer.getDuration(),f=Math.round(e.start/d*h),y=f+(Math.round((e.end-e.start)/d*h)||1)>c&&f<c+o;y&&!n.parentElement?t.appendChild(n):!y&&n.parentElement&&n.remove()};setTimeout((()=>{if(!this.wavesurfer||!e.element)return;r();const o=this.wavesurfer.on("scroll",r),c=this.wavesurfer.on("zoom",r),h=this.wavesurfer.on("resize",r);this.subscriptions.push(o,c,h),e.once("remove",(()=>{o(),c(),h()}))}),0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",(n=>{n||this.adjustScroll(e),this.emit("region-update",e,n)})),e.on("update-end",(n=>{this.avoidOverlapping(e),this.emit("region-updated",e,n)})),e.on("play",(n=>{var r;(r=this.wavesurfer)===null||r===void 0||r.play(e.start,n)})),e.on("click",(n=>{this.emit("region-clicked",e,n)})),e.on("dblclick",(n=>{this.emit("region-double-clicked",e,n)})),e.on("content-changed",(()=>{this.emit("region-content-changed",e)})),e.once("remove",(()=>{t.forEach((n=>n())),this.regions=this.regions.filter((n=>n!==e)),this.emit("region-removed",e)}))];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,n;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const r=this.wavesurfer.getDuration(),o=(n=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||n===void 0?void 0:n.numberOfChannels,c=new ar(e,r,o);return this.emit("region-initialized",c),r?this.saveRegion(c):this.subscriptions.push(this.wavesurfer.once("ready",(h=>{c._setTotalDuration(h),this.saveRegion(c)}))),c}enableDragSelection(e,t=3){var n;const r=(n=this.wavesurfer)===null||n===void 0?void 0:n.getWrapper();if(!(r&&r instanceof HTMLElement))return()=>{};let o=null,c=0,h=0;return yn(r,((d,f,y)=>{o&&o._onUpdate(d,y>c?"end":"start",h)}),(d=>{var f,y;if(c=d,!this.wavesurfer)return;const I=this.wavesurfer.getDuration(),T=(y=(f=this.wavesurfer)===null||f===void 0?void 0:f.getDecodedData())===null||y===void 0?void 0:y.numberOfChannels,{width:S}=this.wavesurfer.getWrapper().getBoundingClientRect();h=c/S*I;const A=d/S*I,P=(d+5)/S*I;o=new ar(Object.assign(Object.assign({},e),{start:A,end:P}),I,T),this.emit("region-initialized",o),o.element&&this.regionsContainer.appendChild(o.element)}),(()=>{o&&(this.saveRegion(o),o.updatingSide=void 0,o=null)}),t)}clearRegions(){this.regions.slice().forEach((e=>e.remove())),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}class fc{constructor(e){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineContext=window.OfflineAudioContext||window.webkitOfflineAudioContext,!window.AudioContext||!window.OfflineContext){console.error("BeatDetect.ERROR : Your browser doesn't support the WebAudio API.");return}this.VERSION="1.0.0",this._log=e.log||!1,this._perf=e.perf||!1,this._sampleRate=e.sampleRate||44100,this._round=e.round||!1,this._float=e.float||8,this._lowPassFreq=e.lowPassFreq||150,this._highPassFreq=e.highPassFreq||100,this._bpmRange=e.bpmRange||[90,180],this._timeSignature=e.timeSignature||4,this.count=0,this._ts={current:0,previous:0,first:0},this._tapResetId=-1}getBeatInfo(e){return e.perf={m0:performance.now(),m1:0,m2:0,m3:0},new Promise((t,n)=>{this._fetchRawTrack(e).then(this._buildOfflineCtx.bind(this)).then(this._processRenderedBuffer.bind(this)).then(t).catch(n)})}_fetchRawTrack(e){return this._logEvent("log",`Fetch track ${e.name||""}`),new Promise((t,n)=>{let r=new XMLHttpRequest;r.open("GET",e.url,!0),r.responseType="arraybuffer",r.onload=()=>{e.perf.m1=performance.now(),t(Object.assign(r,e))},r.onerror=n,r.send()})}_buildOfflineCtx(e){return this._logEvent("log","Offline rendering of the track"),new Promise((t,n)=>{new AudioContext().decodeAudioData(e.response,o=>{const c=new window.OfflineContext(2,o.duration*this._sampleRate,this._sampleRate),h=c.createBufferSource();h.buffer=o;const d=c.createBiquadFilter();d.type="lowpass",d.frequency.value=this._lowPassFreq,d.Q.value=1;const f=c.createBiquadFilter();f.type="highpass",f.frequency.value=this._highPassFreq,f.Q.value=1,h.connect(d),d.connect(f),f.connect(c.destination),h.start(0),c.startRendering(),c.oncomplete=y=>{e.perf.m2=performance.now(),t(Object.assign(y,e))},c.onerror=n})})}_processRenderedBuffer(e){return this._logEvent("log","Collect beat info"),new Promise(t=>{const n=e.renderedBuffer.getChannelData(0),r=e.renderedBuffer.getChannelData(1),o=this._getPeaks([n,r]);var h=this._getIntervals(o).sort((f,y)=>y.count-f.count).splice(0,5);const d=this._getOffsets(n,h[0].tempo);e.perf.m3=performance.now(),this._logEvent("log","Analysis done"),t(Object.assign({bpm:h[0].tempo,offset:this._floatRound(d.offset,this._float),firstBar:this._floatRound(d.firstBar,this._float)},this._perf?{perf:this._getPerfDuration(e.perf)}:null))})}_getPeaks(e){const t=this._sampleRate/2,n=e[0].length/t;let r=[];for(let o=0;o<n;++o){let c=0;for(let h=o*t;h<(o+1)*t;++h){const d=Math.max(Math.abs(e[0][h]),Math.abs(e[1][h]));(!c||d>c.volume)&&(c={position:h,volume:d})}r.push(c)}return r.sort((o,c)=>c.volume-o.volume),r=r.splice(0,r.length*.5),r.sort((o,c)=>o.position-c.position),r}_getIntervals(e){const t=[];return e.forEach((n,r)=>{for(let o=1;r+o<e.length&&o<10;++o){const c={tempo:60*this._sampleRate/(e[r+o].position-n.position),count:1,position:n.position,peaks:[]};for(;c.tempo<=this._bpmRange[0];)c.tempo*=2;for(;c.tempo>this._bpmRange[1];)c.tempo/=2;this._round===!0?c.tempo=Math.round(c.tempo):c.tempo=this._floatRound(c.tempo,this._float),t.some(d=>d.tempo===c.tempo?(d.peaks.push(n),++d.count,!0):!1)||t.push(c)}}),t}_getOffsets(e,t){var n=this._sampleRate/2,r=e.length/n,o=[];for(let T=0;T<r;++T){let S=0;for(let A=T*n;A<(T+1)*n;++A){const P=e[A];(!S||P>S.volume)&&(S={position:A-Math.round(60/t*.05*this._sampleRate),volume:P})}o.push(S)}const c=[...o];o.sort((T,S)=>S.volume-T.volume);const h=this._getLowestTimeOffset(o[0].position,t);let d=0,f=0;for(let T=0;T<o.length;++T){const S=this._getLowestTimeOffset(o[T].position,t);(S-h<.05||h-S>-.05)&&(d+=S,++f)}let y=0;for(;c[y].volume<.02;)++y;let I=c[y].position/this._sampleRate;return I>d/f&&I<60/t&&(I=d/f),{offset:d/f,firstBar:I}}_getLowestTimeOffset(e,t){const n=60/t;let o=e/this._sampleRate;for(;o>=n;)o-=n*this._timeSignature;if(o<0)for(;o<0;)o+=n;return o}_getPerfDuration(e){return{total:(e.m3-e.m0)/1e3,fetch:(e.m1-e.m0)/1e3,render:(e.m2-e.m1)/1e3,process:(e.m3-e.m2)/1e3}}tapBpm(e){e.element.addEventListener("click",this._tapBpm.bind(this,e),!1)}_tapBpm(e){if(window.clearTimeout(this._tapResetId),this._ts.current=Date.now(),this._ts.first===0&&(this._ts.first=this._ts.current),this._ts.previous!==0){let t=6e4*this.count/(this._ts.current-this._ts.first);e.precision&&(t=this._floatRound(t,e.precision)),e.callback(t)}this._ts.previous=this._ts.current,++this.count,this._tapResetId=window.setTimeout(()=>{this.count=0,this._ts.current=0,this._ts.previous=0,this._ts.first=0,e.callback("--")},5e3)}_logEvent(e,t){this._log===!0&&console[e](`BeatDetect : ${t}`)}_floatRound(e,t){const n=Math.pow(10,t||0);return Math.round(e*n)/n}set sampleRate(e){this._sampleRate=e}set log(e){this._log=e}set perf(e){this._perf=e}set round(e){this._round=e}set float(e){this._float=e}set lowPassFreq(e){this._lowPassFreq=e}set highPassFreq(e){this._highPassFreq=e}}class pc{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive",sampleRate:44100}),this.wavesurfer=null,this.regions=null,this.activeRegion=null,this.currentRegion=null,this.currentAudioURL="",this.originalBuffer=null,this.isEmpty=!0,this.isLooping=!1,this.zoomLevel=0,this.filters=[],this.eqInputNode=null,this.previewEffectNode=null,this.delayNode=null,this.feedbackNode=null,this.eqInitialized=!1,this.masterGainNode=null,this.previewGainNode=null,this.currentEffectType=null,this.effectParams={},this.bpm=0,this.isMagnetOn=!1,this.quantizeVal=4,this.history=[],this.redoStack=[],this.maxHistory=10,this.beatDetect=new fc({sampleRate:this.audioContext.sampleRate,log:!1,perf:!1,round:!1,float:4,lowPassFreq:150,highPassFreq:100,bpmRange:[70,180],timeSignature:4}),this.initWaveSurfer(),this.setupEventListeners(),this.initBeatDetect()}initWaveSurfer(){this.wavesurfer&&(this.wavesurfer.destroy(),this.wavesurfer=null),this.regions=Oi.create(),this.eqInitialized=!1,this.wavesurfer=Ft.create({container:"#waveform",waveColor:"#ccc",progressColor:"#4b657aff",cursorColor:"#333",height:250,plugins:[this.regions],audioContext:this.audioContext,sampleRate:this.audioContext.sampleRate}),this.setupZoom(),this.setupWaveSurferEvents()}setupZoom(){document.querySelector("#waveform").addEventListener("wheel",t=>{if(this.wavesurfer){t.preventDefault();const n=t.deltaY>0?-50:50;let r=this.wavesurfer.options.minPxPerSec||50,o=Math.max(20,Math.min(r+n,1e3));this.wavesurfer.zoom(o)}},{passive:!1})}setupWaveSurferEvents(){this.wavesurfer.on("decode",()=>{const e=this.wavesurfer.getDecodedData();e&&(this.originalBuffer=e,requestAnimationFrame(()=>this.initEqualizer()),requestAnimationFrame(()=>this.setupKnobListeners()))}),this.wavesurfer.on("ready",async()=>{this.initEqualizer(),this.createTrimUI(),await this.detectBPM();const e=document.getElementById("plus-wrapper");e&&e.remove(),this.regions.enableDragSelection({color:"rgba(165, 165, 165, 0.1)"}),this.initTrimCurtains()}),this.wavesurfer.on("click",()=>this.clearLoop()),this.wavesurfer.on("finish",()=>{this.isLooping&&!this.currentRegion&&this.wavesurfer.play()}),this.regions.on("region-created",e=>{this.isSystemRegion(e)||this.handleRegionCreated(e)}),this.regions.on("region-updated",e=>{this.isSystemRegion(e)||this.handleRegionUpdated(e)}),this.wavesurfer.on("region-click",(e,t)=>{this.isSystemRegion(e)||this.handleRegionClick(e,t)}),this.regions.on("region-in",e=>{this.isSystemRegion(e)||(this.currentRegion=e)}),this.regions.on("region-out",e=>{this.isLooping&&this.currentRegion===e&&e.play()}),this.regions.on("region-removed",e=>{this.activeRegion===e&&(console.log("Active region deleted: cleaning up effects."),this.closeEffectPanel())})}initAudio(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext.state==="suspended"?this.audioContext.resume():(this.initEqualizer(),Promise.resolve())}async loadAudioFile(e){if(e)try{await this.wavesurfer.load(e)}catch(t){console.error("Load Error:",t)}}async reloadWithBuffer(e){const t=er(e,e.length),n=URL.createObjectURL(t);this.originalBuffer=e,this.currentAudioURL=n,await this.wavesurfer.load(n),this.eqInitialized=!1,this.initEqualizer()}isSystemRegion(e){return e.id==="left-curtain"||e.id==="right-curtain"||e.id==="trim-region"}handleRegionCreated(e){const t=e.element,n=document.createElement("div");n.className="region-close-btn",n.textContent="x",n.title="Delete Region",Object.assign(n.style,{position:"absolute",top:"5px",right:"5px",width:"24px",height:"24px",backgroundColor:"--var(dgrey)",color:"white",borderRadius:"0 0 0 4px",fontFamily:"Pixelify Sans, system-ui",fontSize:"20px",lineHeight:"22px",textAlign:"center",cursor:"pointer",zIndex:"10",userSelect:"none"}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="--var(dgrey)",n.style.transform="scale(1.2)"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="--var(lgrey)",n.style.transform="scale(1)"}),n.addEventListener("click",r=>{r.stopPropagation(),e.remove(),this.currentRegion===e&&(this.currentRegion=null)}),t.appendChild(n),this.setupRegionDropZone(e,t),e.on("dblclick",r=>{r.preventDefault(),r.stopPropagation(),this.isLooping||document.getElementById("loop-button").click(),this.setCurrentRegion(e)})}setupRegionDropZone(e,t){t.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation(),t.style.border="2px solid rgba(255, 255, 255, 0.5)",t.style.backgroundColor="rgba(255, 255, 255, 0.3)"}),t.addEventListener("dragleave",n=>{n.preventDefault(),n.stopPropagation(),t.style.border="0px solid rgba(255, 255, 255, 0.5)",t.style.backgroundColor=e.color}),t.addEventListener("drop",n=>{n.preventDefault(),n.stopPropagation();const r=document.getElementById("waveform");r&&r.classList.remove("dragover"),t.style.backgroundColor=e.color,t.style.border="none";const o=n.dataTransfer.getData("effectType");if(o){const c=e.color;t.style.backgroundColor="color-mix(in srgb, var(--lgrey) 30%, transparent)",setTimeout(()=>{t&&(t.style.backgroundColor=c)},300),o==="reverse"?this.applyDirectEffect(e,"reverse"):["distortion","delay","bitcrush"].includes(o)&&this.activateRealTimePreview(e,o)}})}handleRegionUpdated(e){}handleRegionClick(e,t){t.stopPropagation(),this.setCurrentRegion(e)}setCurrentRegion(e){this.currentRegion&&(this.currentRegion.setOptions({color:"rgba(255, 255, 255, 0.1)"}),this.currentRegion.element&&(this.currentRegion.element.style.border="none",this.currentRegion.element.style.zIndex="10")),this.currentRegion=e,e.setOptions({color:"rgba(255, 255, 255, 0.2)"}),e.element&&(e.element.style.boxSizing="border-box",e.element.style.border="1px solid rgba(255, 255, 255, 0.5)",e.element.style.zIndex="100"),this.wavesurfer.isPlaying()&&e.play()}clearLoop(){this.currentRegion&&(this.currentRegion.setOptions({color:"rgba(255, 255, 255, 0.1)"}),this.currentRegion.element&&(this.currentRegion.element.style.border="none",this.currentRegion.element.style.zIndex="10"),this.currentRegion=null)}initEqualizer(){const e=this.wavesurfer.getMediaElement();if(!e)return;e.crossOrigin="anonymous",this.masterGainNode||(this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=.8),this.mediaNode||(this.mediaNode=this.audioContext.createMediaElementSource(e)),this.eqInputNode||(this.eqInputNode=this.audioContext.createGain()),this.filters.length===0&&(this.filters=Ii.map(r=>{const o=this.audioContext.createBiquadFilter();return o.type=r<=32?"lowshelf":r>=16e3?"highshelf":"peaking",o.frequency.value=r,o}),this.connectSliders());try{this.mediaNode.disconnect()}catch{}try{this.eqInputNode.disconnect()}catch{}try{this.previewEffectNode&&this.previewEffectNode.disconnect()}catch{}try{this.delayNode&&this.delayNode.disconnect()}catch{}try{this.feedbackNode&&this.feedbackNode.disconnect()}catch{}try{this.previewGainNode&&this.previewGainNode.disconnect()}catch{}this.filters.forEach(r=>{try{r.disconnect()}catch{}}),this.masterGainNode.disconnect(),(this.currentEffectType==="distortion"||this.currentEffectType==="bitcrush")&&this.previewEffectNode?(this.mediaNode.connect(this.previewEffectNode),this.previewEffectNode.connect(this.eqInputNode)):this.currentEffectType==="delay"&&this.delayNode?(this.mediaNode.connect(this.eqInputNode),this.mediaNode.connect(this.delayNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.delayNode.connect(this.eqInputNode)):this.mediaNode.connect(this.eqInputNode);let t=this.eqInputNode;this.currentEffectType&&this.previewGainNode&&(this.eqInputNode.disconnect(),this.eqInputNode.connect(this.previewGainNode),t=this.previewGainNode);let n=t;this.filters.forEach(r=>{n.connect(r),n=r}),n.connect(this.masterGainNode),this.masterGainNode.connect(this.audioContext.destination),this.eqInitialized=!0}connectSliders(){document.querySelectorAll(".slider-eq").forEach((t,n)=>{this.filters[n]&&(this.filters[n].gain.value=t.value,t.oninput=r=>{this.filters[n].gain.value=r.target.value})})}async applyDirectEffect(e,t){if(this.originalBuffer)try{const n=await tr(this.originalBuffer,this.audioContext,t,e.start,e.end);n&&await this.reloadWithBuffer(n)}catch{}}activateRealTimePreview(e,t){this.closeEffectPanel(),this.activeRegion=e,this.currentEffectType=t;const n=document.getElementById("knobs-rack");console.log("ciao"),n&&n.classList.remove("hidden"),this.previewGainNode=this.audioContext.createGain();const r=.8;this.previewGainNode.gain.value=r,this.effectParams.volume=r;const o=document.getElementById("knob-vol");o&&this.updateKnobVisual(o,r);const c=document.getElementById("val-vol");c&&(c.innerText="80%");let h=.5,d=.5;if(t==="distortion")document.getElementById("label-p1").innerText="DRIVE",document.getElementById("label-p2").innerText="---",this.effectParams.amount=50,h=50/400,this.previewEffectNode=this.audioContext.createWaveShaper(),this.previewEffectNode.curve=mn(this.effectParams.amount),this.previewEffectNode.oversample="4x";else if(t==="delay")document.getElementById("label-p1").innerText="TIME",document.getElementById("label-p2").innerText="F.BACK",this.effectParams.time=.25,this.effectParams.feedback=.4,h=.25,d=.4/.9,this.delayNode=this.audioContext.createDelay(2),this.delayNode.delayTime.value=.25,this.feedbackNode=this.audioContext.createGain(),this.feedbackNode.gain.value=.4;else if(t==="bitcrush"){document.getElementById("label-p1").innerText="BITS",document.getElementById("label-p2").innerText="FREQ",this.effectParams.bits=8,this.effectParams.normFreq=.1,h=8/16,d=.1;const y=4096;this.previewEffectNode=this.audioContext.createScriptProcessor(y,1,1),this.previewEffectNode.onaudioprocess=I=>{const T=I.inputBuffer.getChannelData(0),S=I.outputBuffer.getChannelData(0),A=1/Math.pow(2,this.effectParams.bits),P=Math.floor(1/this.effectParams.normFreq);for(let R=0;R<y;R++)S[R]=R%P===0?Math.round(T[R]/A)*A:R>0?S[R-1]:0}}this.updateKnobVisual(document.getElementById("knob-p1"),h),this.updateEffectParam(1,h),t!=="distortion"?(this.updateKnobVisual(document.getElementById("knob-p2"),d),this.updateEffectParam(2,d)):(this.updateKnobVisual(document.getElementById("knob-p2"),0),document.getElementById("val-p2").innerText="--");const f=document.createElement("div");f.className="region-apply-btn",f.innerText="APPLY",Object.assign(f.style,{position:"absolute",bottom:"50px",left:"50%",transform:"translateX(-50%)",backgroundColor:"color-mix(in srgb, var(--lgrey), transparent 20%)",color:"white",border:"2px solid black",fontFamily:'"Pixelify Sans", system-ui',fontSize:"24px",fontWeight:"bold",padding:"2px 8px",cursor:"pointer",zIndex:"1000",boxShadow:"2px 2px 0px rgba(0,0,0,0.5)",pointerEvents:"auto",whiteSpace:"nowrap"}),f.onclick=y=>{y.stopPropagation(),this.freezeCurrentEffect()},e.element.appendChild(f),this.currentApplyBtn=f,this.eqInitialized=!1,this.initEqualizer(),this.isLooping||document.getElementById("loop-button").click(),e.play()}createSlider(e,t,n,r,o,c){const h=document.createElement("div");h.style.marginBottom="10px";const d=document.createElement("span");d.innerText=`${e}: `;const f=document.createElement("span");f.innerText=o,f.style.marginLeft="5px",f.style.color="#aaa";const y=document.createElement("input");return y.type="range",y.min=t,y.max=n,y.step=r,y.value=o,y.style.width="100%",y.oninput=I=>{const T=parseFloat(I.target.value);f.innerText=T,c(T)},h.appendChild(d),h.appendChild(y),h.appendChild(f),h}createEffectControlsUI(e){let t=document.getElementById("effect-controls-wrapper");t||(t=document.createElement("div"),t.id="effect-controls-wrapper",Object.assign(t.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#222",padding:"15px",borderRadius:"8px",border:"1px solid #444",color:"white",zIndex:"1000",minWidth:"250px"}),document.body.appendChild(t)),t.innerHTML="",t.style.display="block";const n=document.createElement("h4");n.innerText=e.toUpperCase(),n.style.margin="0 0 10px 0",t.appendChild(n),e==="distortion"?t.appendChild(this.createSlider("Drive",0,400,1,this.effectParams.amount,h=>{this.effectParams.amount=h,this.previewEffectNode&&(this.previewEffectNode.curve=mn(h))})):e==="delay"?(t.appendChild(this.createSlider("Time (s)",.01,1,.01,this.effectParams.time,h=>{this.effectParams.time=h,this.delayNode&&this.delayNode.delayTime.linearRampToValueAtTime(h,this.audioContext.currentTime+.1)})),t.appendChild(this.createSlider("Feedback",0,.9,.05,this.effectParams.feedback,h=>{this.effectParams.feedback=h,this.feedbackNode&&(this.feedbackNode.gain.value=h)}))):e==="bitcrush"&&(t.appendChild(this.createSlider("Bits",1,16,1,this.effectParams.bits,h=>{this.effectParams.bits=h})),t.appendChild(this.createSlider("Freq (Norm)",.01,1,.01,this.effectParams.normFreq,h=>{this.effectParams.normFreq=h})));const r=document.createElement("div");r.style.display="flex",r.style.gap="10px",r.style.marginTop="15px";const o=document.createElement("button");o.innerText="FREEZE",Object.assign(o.style,{background:"var(--color-green)",color:"#000",border:"none",padding:"8px 15px",cursor:"pointer",fontWeight:"bold"}),o.onclick=()=>this.freezeCurrentEffect();const c=document.createElement("button");c.innerText="CANCEL",Object.assign(c.style,{background:"#555",color:"white",border:"none",padding:"8px 15px",cursor:"pointer"}),c.onclick=()=>this.closeEffectPanel(),r.appendChild(o),r.appendChild(c),t.appendChild(r)}async freezeCurrentEffect(){if(this.activeRegion)try{const e=await tr(this.originalBuffer,this.audioContext,this.currentEffectType,this.activeRegion.start,this.activeRegion.end,this.effectParams);if(e&&this.effectParams.volume!==void 0){const t=this.effectParams.volume,n=Math.floor(this.activeRegion.start*e.sampleRate),r=Math.floor(this.activeRegion.end*e.sampleRate);for(let o=0;o<e.numberOfChannels;o++){const c=e.getChannelData(o);for(let h=n;h<r&&h<c.length;h++)c[h]=c[h]*t}}this.closeEffectPanel(),e&&await this.reloadWithBuffer(e)}catch(e){console.error("Freeze Error:",e)}}closeEffectPanel(){const e=document.getElementById("knobs-rack");e&&e.classList.add("hidden"),this.currentApplyBtn&&(this.currentApplyBtn.remove(),this.currentApplyBtn=null),this.previewEffectNode=null,this.delayNode=null,this.feedbackNode=null,this.previewGainNode=null,this.activeRegion=null,this.currentEffectType=null;const t=document.getElementById("label-p1");t&&(t.innerText="PARAM 1");const n=document.getElementById("label-p2");n&&(n.innerText="PARAM 2"),this.eqInitialized=!1,this.initEqualizer()}setupKnobListeners(){const e=document.getElementById("freeze-btn");e&&e.addEventListener("click",()=>this.freezeCurrentEffect());const t=(n,r)=>{const o=document.getElementById(`knob-${n}`);if(!o)return;let c=0,h=0;const d=y=>{const I=c-y.clientY;let S=h+I*.005;S=Math.max(0,Math.min(1,S)),this.updateKnobVisual(o,S),r(S)},f=()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",f),document.body.style.cursor="default"};o.addEventListener("mousedown",y=>{y.preventDefault(),c=y.clientY,h=parseFloat(o.dataset.value)||0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",f),document.body.style.cursor="ns-resize"})};t("p1",n=>{this.currentEffectType&&this.updateEffectParam(1,n)}),t("p2",n=>{this.currentEffectType&&this.updateEffectParam(2,n)}),t("vol",n=>{this.currentEffectType?(this.previewGainNode&&(this.previewGainNode.gain.value=n),this.effectParams.volume=n):this.masterGainNode&&(this.masterGainNode.gain.value=n);const r=document.getElementById("val-vol");r&&(r.innerText=Math.round(n*100)+"%")})}updateKnobVisual(e,t){e.dataset.value=t;const n=t*270-135,r=e.querySelector(".knob-indicator");r&&(r.style.transform=`translate(-50%, -100%) rotate(${n}deg)`)}updateEffectParam(e,t){const n=this.currentEffectType;if(n==="distortion"){if(e===1){const r=t*400;this.effectParams.amount=r,document.getElementById("val-p1").innerText=Math.floor(r),this.previewEffectNode&&(this.previewEffectNode.curve=mn(r))}}else if(n==="delay"){if(e===1){const r=.01+t*.99;this.effectParams.time=r,document.getElementById("val-p1").innerText=r.toFixed(2)+"s",this.delayNode&&this.delayNode.delayTime.linearRampToValueAtTime(r,this.audioContext.currentTime+.1)}if(e===2){const r=t*.9;this.effectParams.feedback=r,document.getElementById("val-p2").innerText=Math.floor(r*100)+"%",this.feedbackNode&&(this.feedbackNode.gain.value=r)}}else if(n==="bitcrush"){if(e===1){const r=1+Math.floor(t*15);this.effectParams.bits=r,document.getElementById("val-p1").innerText=r+"bit"}if(e===2){const r=.01+t*.99;this.effectParams.normFreq=r,document.getElementById("val-p2").innerText=r.toFixed(2)+"x"}}}initTrimCurtains(){const e=this.wavesurfer.getDuration(),t="rgba(0, 0, 0, 0.65)",n="var(--color-red)";this.regions.getRegions().forEach(r=>{(r.id==="left-curtain"||r.id==="right-curtain")&&r.remove()}),this.leftCurtain=this.regions.addRegion({id:"left-curtain",start:0,end:0,color:t,drag:!1,resize:!0,loop:!1,handleStyle:{left:{display:"none"},right:{backgroundColor:n,width:"4px",opacity:"1",zIndex:"10"}}}),this.rightCurtain=this.regions.addRegion({id:"right-curtain",start:e,end:e,color:t,drag:!1,resize:!0,loop:!1,handleStyle:{left:{backgroundColor:n,width:"4px",opacity:"1",zIndex:"10"},right:{display:"none"}}})}createTrimUI(){const e=document.getElementById("waveform");e.querySelectorAll(".trim-ui-element").forEach(t=>t.remove()),this.trimUI={container:e},this.trimUI.leftOverlay=document.createElement("div"),this.trimUI.leftOverlay.className="trim-overlay trim-ui-element",this.trimUI.leftOverlay.style.cssText="left: 0; width: 0%;",this.trimUI.rightOverlay=document.createElement("div"),this.trimUI.rightOverlay.className="trim-overlay trim-ui-element",this.trimUI.rightOverlay.style.cssText="right: 0; width: 0%;",this.trimUI.leftHandle=document.createElement("div"),this.trimUI.leftHandle.className="trim-handle trim-handle-left trim-ui-element",this.trimUI.leftHandle.innerText="|",this.trimUI.leftHandle.style.left="0%",this.trimUI.rightHandle=document.createElement("div"),this.trimUI.rightHandle.className="trim-handle trim-handle-right trim-ui-element",this.trimUI.rightHandle.innerText="|",this.trimUI.rightHandle.style.cssText="left: 100%; transform: translateX(-100%);",e.append(this.trimUI.leftOverlay,this.trimUI.rightOverlay,this.trimUI.leftHandle,this.trimUI.rightHandle),this.enableDrag(this.trimUI.leftHandle,"left"),this.enableDrag(this.trimUI.rightHandle,"right")}enableDrag(e,t){let n=!1;e.addEventListener("mousedown",r=>{n=!0,r.stopPropagation(),document.body.style.cursor="col-resize"}),window.addEventListener("mousemove",r=>{if(!n)return;r.preventDefault();const o=this.trimUI.container.getBoundingClientRect();let c=r.clientX-o.left;c<0&&(c=0),c>o.width&&(c=o.width);const h=c/o.width*100;if(t==="left"){const d=parseFloat(this.trimUI.rightHandle.style.left)||100;if(h>=d-2)return;e.style.left=h+"%",this.trimUI.leftOverlay.style.width=h+"%"}else{const d=parseFloat(this.trimUI.leftHandle.style.left)||0;if(h<=d+2)return;e.style.left=h+"%",this.trimUI.rightOverlay.style.width=100-h+"%"}}),window.addEventListener("mouseup",()=>{n&&(n=!1,document.body.style.cursor="default")})}async trimAudio(){if(!this.originalBuffer||!this.trimUI)return;let e=parseFloat(this.trimUI.leftHandle.style.left)||0,t=parseFloat(this.trimUI.rightHandle.style.left);isNaN(t)&&(t=100);let n=e/100,r=t/100;const o=.001;if(n<o&&(n=0),r>1-o&&(r=1),n>=r||n===0&&r===1)return;const c=Math.floor(n*this.originalBuffer.length);if(Math.floor(r*this.originalBuffer.length)-c<=0)return;const d=qa(this.originalBuffer,n,r,this.audioContext);d&&(await this.reloadWithBuffer(d),this.regions.clearRegions(),this.createTrimUI())}initBeatDetect(){this.lockTimer=null,this.lastTapTime=0;const e=document.getElementById("bpm-led");this.beatDetect.tapBpm({element:e,precision:4,callback:t=>{const n=Date.now();this.lockTimer&&(clearTimeout(this.lockTimer),this.lockTimer=null),n-this.lastTapTime<=2e3&&(e.classList.remove("bpm-led-locked"),this.bpm=Math.round(t),e.textContent=this.bpm+" BPM"),this.lastTapTime=n,this.lockTimer=setTimeout(()=>e.classList.add("bpm-led-locked"),2e3)}})}async detectBPM(){this.beatDetect.getBeatInfo({url:this.currentAudioURL}).then(e=>{this.bpm=Math.round(e.bpm),document.getElementById("bpm-led").textContent=this.bpm+" BPM"}).catch(e=>{})}initMagnetUI(){const e=document.querySelector(".bpm-led-wrapper");if(!e)return;const t=document.createElement("div");t.style.cssText="display:flex; align-items:center; gap:5px; margin-top:10px; justify-content:center;";const n=document.createElement("div");n.innerHTML='<i class="fa-solid fa-magnet"></i>',n.title="Toggle Snap to Grid",n.style.cssText="cursor:pointer; padding:5px 10px; border-radius:4px; color:#555; border:1px solid #555; fontSize:18px;",n.onclick=()=>{this.isMagnetOn=!this.isMagnetOn;const o=this.isMagnetOn?"var(--color-green)":"#555";n.style.color=o,n.style.borderColor=o};const r=document.createElement("select");r.style.cssText="background-color:#222; color:white; border:1px solid #444; border-radius:4px; padding:2px; fontFamily:Pixelify Sans;",[2,4,8,16].forEach(o=>{const c=document.createElement("option");c.value=o,c.innerText=`1/${o}`,o===4&&(c.selected=!0),r.appendChild(c)}),r.onchange=o=>this.quantizeVal=parseInt(o.target.value),t.append(n,r),e.appendChild(t)}snapRegionToGrid(e){const r=60/(this.bpm>0?this.bpm:120)*(4/this.quantizeVal),o=Math.round(e.start/r)*r;let c=Math.round(e.end/r)*r;c<=o&&(c=o+r),(Math.abs(e.start-o)>.001||Math.abs(e.end-c)>.001)&&e.setOptions({start:o,end:c})}setupBpmInput(){const e=document.getElementById("bpm-led");e&&e.addEventListener("contextmenu",t=>{if(t.preventDefault(),t.stopPropagation(),e.querySelector("input"))return;const n=e.innerText.replace(" BPM",""),r=parseInt(n)||this.bpm||120;e.innerHTML="";const o=document.createElement("input");o.classList.add("BPM_input"),o.type="number",o.value=r,o.style.cssText="width:60px; background:transparent; color:inherit; border:none; font-family:inherit; font-size:inherit; text-align:center; outline:none;",e.appendChild(o),o.focus(),o.select();const c=()=>{let h=parseInt(o.value);h&&h>0&&(this.bpm=h),e.innerText=this.bpm+" BPM",e.classList.remove("bpm-led-locked")};o.addEventListener("keydown",h=>{h.key==="Enter"&&c()}),o.addEventListener("blur",()=>c())})}setupEventListeners(){document.getElementById("play-button").addEventListener("click",()=>this.wavesurfer.play()),document.getElementById("pause-button").addEventListener("click",()=>this.wavesurfer.pause()),document.getElementById("stop-button").addEventListener("click",()=>{this.isLooping&&this.wavesurfer.seekTo(0),this.wavesurfer.stop()}),document.getElementById("loop-button").addEventListener("click",()=>{this.isLooping=!this.isLooping,document.getElementById("loop-button").classList.toggle("old-button-loop")}),document.getElementById("x2-button").addEventListener("click",()=>{this.isLooping&&this.currentRegion&&(this.regions.clearRegions(),this.regions.addRegion({start:this.currentRegion.start,end:this.currentRegion.start+(this.currentRegion.end-this.currentRegion.start)*2,loop:!0,color:"rgba(165, 165, 165, 0.1)",handleStyle:{left:"rgba(0, 150, 255, 0.9)",right:"rgba(0, 150, 255, 0.9)"}}))}),document.getElementById("d2-button").addEventListener("click",()=>{this.isLooping&&this.currentRegion&&(this.wavesurfer.seekTo(this.currentRegion.start),this.regions.clearRegions(),this.regions.addRegion({start:this.currentRegion.start,end:this.currentRegion.start+(this.currentRegion.end-this.currentRegion.start)/2,loop:!0,color:"rgba(165, 165, 165, 0.3)",handleStyle:{left:"rgba(0, 150, 255, 0.9)",right:"rgba(0, 150, 255, 0.9)"}}))}),document.getElementById("trim-btn").addEventListener("click",()=>this.trimAudio()),document.addEventListener("keydown",t=>{t.key.toLowerCase()===" "&&this.wavesurfer.playPause(),(t.ctrlKey||t.metaKey)&&t.key==="z"&&(t.preventDefault(),this.undo()),(t.ctrlKey||t.metaKey)&&(t.key==="y"||t.shiftKey&&t.key==="Z")&&(t.preventDefault(),this.redo())});const e=document.getElementById("export-btn");e&&e.addEventListener("click",()=>{this.exportAudio(),e.style.color,e.style.color="var(--lgrey)",setTimeout(()=>{e.style.color=""},200)}),this.setupGlobalDragDrop(),this.setupBpmInput()}setupGlobalDragDrop(){const e=document.getElementById("waveform");e.addEventListener("dragover",t=>{t.preventDefault();const n=t.dataTransfer.types;n.includes("effecttype")||n.includes("effectType")||e.classList.add("dragover")}),e.addEventListener("dragleave",()=>e.classList.remove("dragover")),e.addEventListener("drop",t=>{if(t.preventDefault(),e.classList.remove("dragover"),t.dataTransfer.getData("effectType"))return;const r=t.dataTransfer.getData("type"),o=t.dataTransfer.getData("audioUrl");if(r==="sample"&&o)this.wavesurfer.load(o),this.currentAudioURL=o;else if(t.dataTransfer.files.length>0){const c=t.dataTransfer.files[0];if(c){const h=URL.createObjectURL(c);this.loadAudioFile(h),this.currentAudioURL=h}}}),document.addEventListener("dragstart",t=>{const n=t.target.closest?t.target.closest(".fx-img"):null;if(n){const r=n.getAttribute("data-effect");r&&(t.dataTransfer.setData("effectType",r),t.dataTransfer.effectAllowed="copy")}})}addToHistory(e){this.history.push(e),this.history.length>this.maxHistory&&this.history.shift(),this.redoStack=[]}undo(){if(this.history.length===0)return;this.redoStack.push(this.currentAudioURL);const e=this.history.pop();this.wavesurfer.load(e),this.currentAudioURL=e,this.regions.clearRegions()}redo(){if(this.redoStack.length===0)return;this.history.push(this.currentAudioURL);const e=this.redoStack.pop();this.wavesurfer.load(e),this.currentAudioURL=e}async exportAudio(){if(!this.originalBuffer)return;const e=new OfflineAudioContext(this.originalBuffer.numberOfChannels,this.originalBuffer.length,this.originalBuffer.sampleRate),t=e.createBufferSource();t.buffer=this.originalBuffer;let n=t;const r=this.filters.map(f=>f.gain.value);if(Ii.forEach((f,y)=>{const I=e.createBiquadFilter();I.type=f<=32?"lowshelf":f>=16e3?"highshelf":"peaking",I.frequency.value=f,I.gain.value=r[y],n.connect(I),n=I}),this.masterGainNode){const f=e.createGain();f.gain.value=this.masterGainNode.gain.value,n.connect(f),n=f}n.connect(e.destination),t.start(0);const o=await e.startRendering(),c=er(o,o.length),h=URL.createObjectURL(c),d=document.createElement("a");d.style.display="none",d.href=h,d.download="sampler_mastered.wav",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(h),document.body.removeChild(d)}}const gc=()=>{};var cr={};const lo=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},mc=function(i){const e=[];let t=0,n=0;for(;t<i.length;){const r=i[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const o=i[t++];e[n++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=i[t++],c=i[t++],h=i[t++],d=((r&7)<<18|(o&63)<<12|(c&63)<<6|h&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const o=i[t++],c=i[t++];e[n++]=String.fromCharCode((r&15)<<12|(o&63)<<6|c&63)}}return e.join("")},ho={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<i.length;r+=3){const o=i[r],c=r+1<i.length,h=c?i[r+1]:0,d=r+2<i.length,f=d?i[r+2]:0,y=o>>2,I=(o&3)<<4|h>>4;let T=(h&15)<<2|f>>6,S=f&63;d||(S=64,c||(T=64)),n.push(t[y],t[I],t[T],t[S])}return n.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(lo(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):mc(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<i.length;){const o=t[i.charAt(r++)],h=r<i.length?t[i.charAt(r)]:0;++r;const f=r<i.length?t[i.charAt(r)]:64;++r;const I=r<i.length?t[i.charAt(r)]:64;if(++r,o==null||h==null||f==null||I==null)throw new yc;const T=o<<2|h>>4;if(n.push(T),f!==64){const S=h<<4&240|f>>2;if(n.push(S),I!==64){const A=f<<6&192|I;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class yc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vc=function(i){const e=lo(i);return ho.encodeByteArray(e,!0)},In=function(i){return vc(i).replace(/\./g,"")},uo=function(i){try{return ho.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function _c(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const wc=()=>_c().__FIREBASE_DEFAULTS__,bc=()=>{if(typeof process>"u"||typeof cr>"u")return;const i=cr.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},Ec=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&uo(i[1]);return e&&JSON.parse(e)},Li=()=>{try{return gc()||wc()||bc()||Ec()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},fo=i=>Li()?.emulatorHosts?.[i],po=i=>{const e=fo(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},go=()=>Li()?.config,mo=i=>Li()?.[`_${i}`];class Ic{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}function gt(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function xi(i){return(await fetch(i,{credentials:"include"})).ok}function yo(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=i.iat||0,o=i.sub||i.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...i};return[In(JSON.stringify(t)),In(JSON.stringify(c)),""].join(".")}const Lt={};function Tc(){const i={prod:[],emulator:[]};for(const e of Object.keys(Lt))Lt[e]?i.emulator.push(e):i.prod.push(e);return i}function Cc(i){let e=document.getElementById(i),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),t=!0),{created:t,element:e}}let lr=!1;function Mi(i,e){if(typeof window>"u"||typeof document>"u"||!gt(window.location.host)||Lt[i]===e||Lt[i]||lr)return;Lt[i]=e;function t(T){return`__firebase__banner__${T}`}const n="__firebase__banner",o=Tc().prod.length>0;function c(){const T=document.getElementById(n);T&&T.remove()}function h(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function d(T,S){T.setAttribute("width","24"),T.setAttribute("id",S),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function f(){const T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{lr=!0,c()},T}function y(T,S){T.setAttribute("id",S),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function I(){const T=Cc(n),S=t("text"),A=document.getElementById(S)||document.createElement("span"),P=t("learnmore"),R=document.getElementById(P)||document.createElement("a"),D=t("preprendIcon"),x=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){const U=T.element;h(U),y(R,P);const B=f();d(x,D),U.append(x,A,R,B),document.body.appendChild(U)}o?(A.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function te(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Sc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(te())}function Ac(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Rc(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function kc(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Pc(){const i=te();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function Dc(){try{return typeof indexedDB=="object"}catch{return!1}}function Nc(){return new Promise((i,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),i(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const Oc="FirebaseError";class ve extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Oc,Object.setPrototypeOf(this,ve.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wt.prototype.create)}}class Wt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],c=o?Lc(o,n):"Error",h=`${this.serviceName}: ${c} (${r}).`;return new ve(r,h,n)}}function Lc(i,e){return i.replace(xc,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const xc=/\{\$([^}]+)}/g;function Mc(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function Ye(i,e){if(i===e)return!0;const t=Object.keys(i),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const o=i[r],c=e[r];if(hr(o)&&hr(c)){if(!Ye(o,c))return!1}else if(o!==c)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function hr(i){return i!==null&&typeof i=="object"}function $t(i){const e=[];for(const[t,n]of Object.entries(i))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Uc(i,e){const t=new Bc(i,e);return t.subscribe.bind(t)}class Bc{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Fc(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:n},r.next===void 0&&(r.next=fi),r.error===void 0&&(r.error=fi),r.complete===void 0&&(r.complete=fi);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Fc(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function fi(){}function tt(i){return i&&i._delegate?i._delegate:i}class Fe{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const $e="[DEFAULT]";class Vc{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Ic;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Hc(e))try{this.getOrInitializeService({instanceIdentifier:$e})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});n.resolve(o)}catch{}}}}clearInstance(e=$e){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=$e){return this.instances.has(e)}getOptions(e=$e){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[o,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);n===h&&c.resolve(r)}return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const o=this.instances.get(n);return o&&e(o,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:jc(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=$e){return this.component?this.component.multipleInstances?e:$e:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jc(i){return i===$e?void 0:i}function Hc(i){return i.instantiationMode==="EAGER"}class zc{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Vc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var H;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(H||(H={}));const Wc={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},$c=H.INFO,qc={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Gc=(i,e,...t)=>{if(e<i.logLevel)return;const n=new Date().toISOString(),r=qc[e];if(r)console[r](`[${n}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ui{constructor(e){this.name=e,this._logLevel=$c,this._logHandler=Gc,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in H))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...e),this._logHandler(this,H.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...e),this._logHandler(this,H.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,H.INFO,...e),this._logHandler(this,H.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,H.WARN,...e),this._logHandler(this,H.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...e),this._logHandler(this,H.ERROR,...e)}}const Kc=(i,e)=>e.some(t=>i instanceof t);let ur,dr;function Xc(){return ur||(ur=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Jc(){return dr||(dr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const vo=new WeakMap,Ti=new WeakMap,_o=new WeakMap,pi=new WeakMap,Bi=new WeakMap;function Yc(i){const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("success",o),i.removeEventListener("error",c)},o=()=>{t(Ue(i.result)),r()},c=()=>{n(i.error),r()};i.addEventListener("success",o),i.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&vo.set(t,i)}).catch(()=>{}),Bi.set(e,i),e}function Zc(i){if(Ti.has(i))return;const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("complete",o),i.removeEventListener("error",c),i.removeEventListener("abort",c)},o=()=>{t(),r()},c=()=>{n(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",o),i.addEventListener("error",c),i.addEventListener("abort",c)});Ti.set(i,e)}let Ci={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return Ti.get(i);if(e==="objectStoreNames")return i.objectStoreNames||_o.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ue(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function Qc(i){Ci=i(Ci)}function el(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=i.call(gi(this),e,...t);return _o.set(n,e.sort?e.sort():[e]),Ue(n)}:Jc().includes(i)?function(...e){return i.apply(gi(this),e),Ue(vo.get(this))}:function(...e){return Ue(i.apply(gi(this),e))}}function tl(i){return typeof i=="function"?el(i):(i instanceof IDBTransaction&&Zc(i),Kc(i,Xc())?new Proxy(i,Ci):i)}function Ue(i){if(i instanceof IDBRequest)return Yc(i);if(pi.has(i))return pi.get(i);const e=tl(i);return e!==i&&(pi.set(i,e),Bi.set(e,i)),e}const gi=i=>Bi.get(i);function nl(i,e,{blocked:t,upgrade:n,blocking:r,terminated:o}={}){const c=indexedDB.open(i,e),h=Ue(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Ue(c.result),d.oldVersion,d.newVersion,Ue(c.transaction),d)}),t&&c.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),r&&d.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const il=["get","getKey","getAll","getAllKeys","count"],sl=["put","add","delete","clear"],mi=new Map;function fr(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(mi.get(e))return mi.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=sl.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||il.includes(t)))return;const o=async function(c,...h){const d=this.transaction(c,r?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[t](...h),r&&d.done]))[0]};return mi.set(e,o),o}Qc(i=>({...i,get:(e,t,n)=>fr(e,t)||i.get(e,t,n),has:(e,t)=>!!fr(e,t)||i.has(e,t)}));class rl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ol(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function ol(i){return i.getComponent()?.type==="VERSION"}const Si="@firebase/app",pr="0.14.6";const Ie=new Ui("@firebase/app"),al="@firebase/app-compat",cl="@firebase/analytics-compat",ll="@firebase/analytics",hl="@firebase/app-check-compat",ul="@firebase/app-check",dl="@firebase/auth",fl="@firebase/auth-compat",pl="@firebase/database",gl="@firebase/data-connect",ml="@firebase/database-compat",yl="@firebase/functions",vl="@firebase/functions-compat",_l="@firebase/installations",wl="@firebase/installations-compat",bl="@firebase/messaging",El="@firebase/messaging-compat",Il="@firebase/performance",Tl="@firebase/performance-compat",Cl="@firebase/remote-config",Sl="@firebase/remote-config-compat",Al="@firebase/storage",Rl="@firebase/storage-compat",kl="@firebase/firestore",Pl="@firebase/ai",Dl="@firebase/firestore-compat",Nl="firebase",Ol="12.6.0";const Ai="[DEFAULT]",Ll={[Si]:"fire-core",[al]:"fire-core-compat",[ll]:"fire-analytics",[cl]:"fire-analytics-compat",[ul]:"fire-app-check",[hl]:"fire-app-check-compat",[dl]:"fire-auth",[fl]:"fire-auth-compat",[pl]:"fire-rtdb",[gl]:"fire-data-connect",[ml]:"fire-rtdb-compat",[yl]:"fire-fn",[vl]:"fire-fn-compat",[_l]:"fire-iid",[wl]:"fire-iid-compat",[bl]:"fire-fcm",[El]:"fire-fcm-compat",[Il]:"fire-perf",[Tl]:"fire-perf-compat",[Cl]:"fire-rc",[Sl]:"fire-rc-compat",[Al]:"fire-gcs",[Rl]:"fire-gcs-compat",[kl]:"fire-fst",[Dl]:"fire-fst-compat",[Pl]:"fire-vertex","fire-js":"fire-js",[Nl]:"fire-js-all"};const Tn=new Map,xl=new Map,Ri=new Map;function gr(i,e){try{i.container.addComponent(e)}catch(t){Ie.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function Ze(i){const e=i.name;if(Ri.has(e))return Ie.debug(`There were multiple attempts to register component ${e}.`),!1;Ri.set(e,i);for(const t of Tn.values())gr(t,i);for(const t of xl.values())gr(t,i);return!0}function Ln(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function se(i){return i==null?!1:i.settings!==void 0}const Ml={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Be=new Wt("app","Firebase",Ml);class Ul{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Fe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Be.create("app-deleted",{appName:this._name})}}const nt=Ol;function wo(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const n={name:Ai,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw Be.create("bad-app-name",{appName:String(r)});if(t||(t=go()),!t)throw Be.create("no-options");const o=Tn.get(r);if(o){if(Ye(t,o.options)&&Ye(n,o.config))return o;throw Be.create("duplicate-app",{appName:r})}const c=new zc(r);for(const d of Ri.values())c.addComponent(d);const h=new Ul(t,n,c);return Tn.set(r,h),h}function Fi(i=Ai){const e=Tn.get(i);if(!e&&i===Ai&&go())return wo();if(!e)throw Be.create("no-app",{appName:i});return e}function pe(i,e,t){let n=Ll[i]??i;t&&(n+=`-${t}`);const r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const c=[`Unable to register library "${n}" with version "${e}":`];r&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ie.warn(c.join(" "));return}Ze(new Fe(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const Bl="firebase-heartbeat-database",Fl=1,Vt="firebase-heartbeat-store";let yi=null;function bo(){return yi||(yi=nl(Bl,Fl,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(Vt)}catch(t){console.warn(t)}}}}).catch(i=>{throw Be.create("idb-open",{originalErrorMessage:i.message})})),yi}async function Vl(i){try{const t=(await bo()).transaction(Vt),n=await t.objectStore(Vt).get(Eo(i));return await t.done,n}catch(e){if(e instanceof ve)Ie.warn(e.message);else{const t=Be.create("idb-get",{originalErrorMessage:e?.message});Ie.warn(t.message)}}}async function mr(i,e){try{const n=(await bo()).transaction(Vt,"readwrite");await n.objectStore(Vt).put(e,Eo(i)),await n.done}catch(t){if(t instanceof ve)Ie.warn(t.message);else{const n=Be.create("idb-set",{originalErrorMessage:t?.message});Ie.warn(n.message)}}}function Eo(i){return`${i.name}!${i.options.appId}`}const jl=1024,Hl=30;class zl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $l(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=yr();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>Hl){const r=ql(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ie.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=yr(),{heartbeatsToSend:t,unsentEntries:n}=Wl(this._heartbeatsCache.heartbeats),r=In(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Ie.warn(e),""}}}function yr(){return new Date().toISOString().substring(0,10)}function Wl(i,e=jl){const t=[];let n=i.slice();for(const r of i){const o=t.find(c=>c.agent===r.agent);if(o){if(o.dates.push(r.date),vr(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),vr(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class $l{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Dc()?Nc().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Vl(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return mr(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return mr(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function vr(i){return In(JSON.stringify({version:2,heartbeats:i})).length}function ql(i){if(i.length===0)return-1;let e=0,t=i[0].date;for(let n=1;n<i.length;n++)i[n].date<t&&(t=i[n].date,e=n);return e}function Gl(i){Ze(new Fe("platform-logger",e=>new rl(e),"PRIVATE")),Ze(new Fe("heartbeat",e=>new zl(e),"PRIVATE")),pe(Si,pr,i),pe(Si,pr,"esm2020"),pe("fire-js","")}Gl("");function Io(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Kl=Io,To=new Wt("auth","Firebase",Io());const Cn=new Ui("@firebase/auth");function Xl(i,...e){Cn.logLevel<=H.WARN&&Cn.warn(`Auth (${nt}): ${i}`,...e)}function vn(i,...e){Cn.logLevel<=H.ERROR&&Cn.error(`Auth (${nt}): ${i}`,...e)}function Te(i,...e){throw Vi(i,...e)}function ge(i,...e){return Vi(i,...e)}function Co(i,e,t){const n={...Kl(),[e]:t};return new Wt("auth","Firebase",n).create(e,{appName:i.name})}function Ke(i){return Co(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Vi(i,...e){if(typeof i!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=i.name),i._errorFactory.create(t,...n)}return To.create(i,...e)}function L(i,e,...t){if(!i)throw Vi(e,...t)}function be(i){const e="INTERNAL ASSERTION FAILED: "+i;throw vn(e),new Error(e)}function Ce(i,e){i||be(e)}function ki(){return typeof self<"u"&&self.location?.href||""}function Jl(){return _r()==="http:"||_r()==="https:"}function _r(){return typeof self<"u"&&self.location?.protocol||null}function Yl(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Jl()||Rc()||"connection"in navigator)?navigator.onLine:!0}function Zl(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class qt{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ce(t>e,"Short delay should be less than long delay!"),this.isMobile=Sc()||kc()}get(){return Yl()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ji(i,e){Ce(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class So{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;be("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;be("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;be("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ql={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const eh=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],th=new qt(3e4,6e4);function Hi(i,e){return i.tenantId&&!e.tenantId?{...e,tenantId:i.tenantId}:e}async function mt(i,e,t,n,r={}){return Ao(i,r,async()=>{let o={},c={};n&&(e==="GET"?c=n:o={body:JSON.stringify(n)});const h=$t({key:i.config.apiKey,...c}).slice(1),d=await i._getAdditionalHeaders();d["Content-Type"]="application/json",i.languageCode&&(d["X-Firebase-Locale"]=i.languageCode);const f={method:e,headers:d,...o};return Ac()||(f.referrerPolicy="no-referrer"),i.emulatorConfig&&gt(i.emulatorConfig.host)&&(f.credentials="include"),So.fetch()(await Ro(i,i.config.apiHost,t,h),f)})}async function Ao(i,e,t){i._canInitEmulator=!1;const n={...Ql,...e};try{const r=new ih(i),o=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const c=await o.json();if("needConfirmation"in c)throw un(i,"account-exists-with-different-credential",c);if(o.ok&&!("errorMessage"in c))return c;{const h=o.ok?c.errorMessage:c.error.message,[d,f]=h.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw un(i,"credential-already-in-use",c);if(d==="EMAIL_EXISTS")throw un(i,"email-already-in-use",c);if(d==="USER_DISABLED")throw un(i,"user-disabled",c);const y=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Co(i,y,f);Te(i,y)}}catch(r){if(r instanceof ve)throw r;Te(i,"network-request-failed",{message:String(r)})}}async function nh(i,e,t,n,r={}){const o=await mt(i,e,t,n,r);return"mfaPendingCredential"in o&&Te(i,"multi-factor-auth-required",{_serverResponse:o}),o}async function Ro(i,e,t,n){const r=`${e}${t}?${n}`,o=i,c=o.config.emulator?ji(i.config,r):`${i.config.apiScheme}://${r}`;return eh.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(c).toString():c}class ih{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(ge(this.auth,"network-request-failed")),th.get())})}}function un(i,e,t){const n={appName:i.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=ge(i,e,n);return r.customData._tokenResponse=t,r}async function sh(i,e){return mt(i,"POST","/v1/accounts:delete",e)}async function Sn(i,e){return mt(i,"POST","/v1/accounts:lookup",e)}function xt(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function rh(i,e=!1){const t=tt(i),n=await t.getIdToken(e),r=zi(n);L(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const o=typeof r.firebase=="object"?r.firebase:void 0,c=o?.sign_in_provider;return{claims:r,token:n,authTime:xt(vi(r.auth_time)),issuedAtTime:xt(vi(r.iat)),expirationTime:xt(vi(r.exp)),signInProvider:c||null,signInSecondFactor:o?.sign_in_second_factor||null}}function vi(i){return Number(i)*1e3}function zi(i){const[e,t,n]=i.split(".");if(e===void 0||t===void 0||n===void 0)return vn("JWT malformed, contained fewer than 3 sections"),null;try{const r=uo(t);return r?JSON.parse(r):(vn("Failed to decode base64 JWT payload"),null)}catch(r){return vn("Caught error parsing JWT payload as JSON",r?.toString()),null}}function wr(i){const e=zi(i);return L(e,"internal-error"),L(typeof e.exp<"u","internal-error"),L(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function jt(i,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof ve&&oh(n)&&i.auth.currentUser===i&&await i.auth.signOut(),n}}function oh({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class ah{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Pi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=xt(this.lastLoginAt),this.creationTime=xt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function An(i){const e=i.auth,t=await i.getIdToken(),n=await jt(i,Sn(e,{idToken:t}));L(n?.users.length,e,"internal-error");const r=n.users[0];i._notifyReloadListener(r);const o=r.providerUserInfo?.length?ko(r.providerUserInfo):[],c=lh(i.providerData,o),h=i.isAnonymous,d=!(i.email&&r.passwordHash)&&!c?.length,f=h?d:!1,y={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:c,metadata:new Pi(r.createdAt,r.lastLoginAt),isAnonymous:f};Object.assign(i,y)}async function ch(i){const e=tt(i);await An(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function lh(i,e){return[...i.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function ko(i){return i.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function hh(i,e){const t=await Ao(i,{},async()=>{const n=$t({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:o}=i.config,c=await Ro(i,r,"/v1/token",`key=${o}`),h=await i._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const d={method:"POST",headers:h,body:n};return i.emulatorConfig&&gt(i.emulatorConfig.host)&&(d.credentials="include"),So.fetch()(c,d)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function uh(i,e){return mt(i,"POST","/v2/accounts:revokeToken",Hi(i,e))}class lt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){L(e.idToken,"internal-error"),L(typeof e.idToken<"u","internal-error"),L(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):wr(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){L(e.length!==0,"internal-error");const t=wr(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(L(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:o}=await hh(e,t);this.updateTokensAndExpiration(n,r,Number(o))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:o}=t,c=new lt;return n&&(L(typeof n=="string","internal-error",{appName:e}),c.refreshToken=n),r&&(L(typeof r=="string","internal-error",{appName:e}),c.accessToken=r),o&&(L(typeof o=="number","internal-error",{appName:e}),c.expirationTime=o),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lt,this.toJSON())}_performRefresh(){return be("not implemented")}}function Ne(i,e){L(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class re{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new ah(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Pi(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await jt(this,this.stsTokenManager.getToken(this.auth,e));return L(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return rh(this,e)}reload(){return ch(this)}_assign(e){this!==e&&(L(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new re({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await An(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(se(this.auth.app))return Promise.reject(Ke(this.auth));const e=await this.getIdToken();return await jt(this,sh(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,o=t.phoneNumber??void 0,c=t.photoURL??void 0,h=t.tenantId??void 0,d=t._redirectEventId??void 0,f=t.createdAt??void 0,y=t.lastLoginAt??void 0,{uid:I,emailVerified:T,isAnonymous:S,providerData:A,stsTokenManager:P}=t;L(I&&P,e,"internal-error");const R=lt.fromJSON(this.name,P);L(typeof I=="string",e,"internal-error"),Ne(n,e.name),Ne(r,e.name),L(typeof T=="boolean",e,"internal-error"),L(typeof S=="boolean",e,"internal-error"),Ne(o,e.name),Ne(c,e.name),Ne(h,e.name),Ne(d,e.name),Ne(f,e.name),Ne(y,e.name);const D=new re({uid:I,auth:e,email:r,emailVerified:T,displayName:n,isAnonymous:S,photoURL:c,phoneNumber:o,tenantId:h,stsTokenManager:R,createdAt:f,lastLoginAt:y});return A&&Array.isArray(A)&&(D.providerData=A.map(x=>({...x}))),d&&(D._redirectEventId=d),D}static async _fromIdTokenResponse(e,t,n=!1){const r=new lt;r.updateFromServerResponse(t);const o=new re({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await An(o),o}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];L(r.localId!==void 0,"internal-error");const o=r.providerUserInfo!==void 0?ko(r.providerUserInfo):[],c=!(r.email&&r.passwordHash)&&!o?.length,h=new lt;h.updateFromIdToken(n);const d=new re({uid:r.localId,auth:e,stsTokenManager:h,isAnonymous:c}),f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Pi(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!o?.length};return Object.assign(d,f),d}}const br=new Map;function Ee(i){Ce(i instanceof Function,"Expected a class definition");let e=br.get(i);return e?(Ce(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,br.set(i,e),e)}class Po{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Po.type="NONE";const Er=Po;function _n(i,e,t){return`firebase:${i}:${e}:${t}`}class ht{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:o}=this.auth;this.fullUserKey=_n(this.userKey,r.apiKey,o),this.fullPersistenceKey=_n("persistence",r.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Sn(this.auth,{idToken:e}).catch(()=>{});return t?re._fromGetAccountInfoResponse(this.auth,t,e):null}return re._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ht(Ee(Er),e,n);const r=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=r[0]||Ee(Er);const c=_n(n,e.config.apiKey,e.name);let h=null;for(const f of t)try{const y=await f._get(c);if(y){let I;if(typeof y=="string"){const T=await Sn(e,{idToken:y}).catch(()=>{});if(!T)break;I=await re._fromGetAccountInfoResponse(e,T,y)}else I=re._fromJSON(e,y);f!==o&&(h=I),o=f;break}}catch{}const d=r.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!d.length?new ht(o,e,n):(o=d[0],h&&await o._set(c,h.toJSON()),await Promise.all(t.map(async f=>{if(f!==o)try{await f._remove(c)}catch{}})),new ht(o,e,n))}}function Ir(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Lo(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Do(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Mo(e))return"Blackberry";if(Uo(e))return"Webos";if(No(e))return"Safari";if((e.includes("chrome/")||Oo(e))&&!e.includes("edge/"))return"Chrome";if(xo(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=i.match(t);if(n?.length===2)return n[1]}return"Other"}function Do(i=te()){return/firefox\//i.test(i)}function No(i=te()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Oo(i=te()){return/crios\//i.test(i)}function Lo(i=te()){return/iemobile/i.test(i)}function xo(i=te()){return/android/i.test(i)}function Mo(i=te()){return/blackberry/i.test(i)}function Uo(i=te()){return/webos/i.test(i)}function Wi(i=te()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function dh(i=te()){return Wi(i)&&!!window.navigator?.standalone}function fh(){return Pc()&&document.documentMode===10}function Bo(i=te()){return Wi(i)||xo(i)||Uo(i)||Mo(i)||/windows phone/i.test(i)||Lo(i)}function Fo(i,e=[]){let t;switch(i){case"Browser":t=Ir(te());break;case"Worker":t=`${Ir(te())}-${i}`;break;default:t=i}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${nt}/${n}`}class ph{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=o=>new Promise((c,h)=>{try{const d=e(o);c(d)}catch(d){h(d)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}async function gh(i,e={}){return mt(i,"GET","/v2/passwordPolicy",Hi(i,e))}const mh=6;class yh{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??mh,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class vh{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tr(this),this.idTokenSubscription=new Tr(this),this.beforeStateQueue=new ph(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=To,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ee(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ht.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Sn(this,{idToken:e}),n=await re._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(se(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,c=n?._redirectEventId,h=await this.tryRedirectSignIn(e);(!o||o===c)&&h?.user&&(n=h.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return L(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await An(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Zl()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(se(this.app))return Promise.reject(Ke(this));const t=e?tt(e):null;return t&&L(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&L(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return se(this.app)?Promise.reject(Ke(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return se(this.app)?Promise.reject(Ke(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ee(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gh(this),t=new yh(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Wt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await uh(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ee(e)||this._popupRedirectResolver;L(t,this,"argument-error"),this.redirectPersistenceManager=await ht.create(this,[Ee(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let c=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(h,this,"internal-error"),h.then(()=>{c||o(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,r);return()=>{c=!0,d()}}else{const d=e.addObserver(t);return()=>{c=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Fo(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(se(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Xl(`Error while retrieving App Check token: ${e.error}`),e?.token}}function $i(i){return tt(i)}class Tr{constructor(e){this.auth=e,this.observer=null,this.addObserver=Uc(t=>this.observer=t)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let qi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _h(i){qi=i}function wh(i){return qi.loadJS(i)}function bh(){return qi.gapiScript}function Eh(i){return`__${i}${Math.floor(Math.random()*1e6)}`}function Ih(i,e){const t=Ln(i,"auth");if(t.isInitialized()){const r=t.getImmediate(),o=t.getOptions();if(Ye(o,e??{}))return r;Te(r,"already-initialized")}return t.initialize({options:e})}function Th(i,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(Ee);e?.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(n,e?.popupRedirectResolver)}function Ch(i,e,t){const n=$i(i);L(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,o=Vo(e),{host:c,port:h}=Sh(e),d=h===null?"":`:${h}`,f={url:`${o}//${c}${d}/`},y=Object.freeze({host:c,port:h,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!n._canInitEmulator){L(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),L(Ye(f,n.config.emulator)&&Ye(y,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=f,n.emulatorConfig=y,n.settings.appVerificationDisabledForTesting=!0,gt(c)?(xi(`${o}//${c}${d}`),Mi("Auth",!0)):Ah()}function Vo(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function Sh(i){const e=Vo(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const o=r[1];return{host:o,port:Cr(n.substr(o.length+1))}}else{const[o,c]=n.split(":");return{host:o,port:Cr(c)}}}function Cr(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function Ah(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class jo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return be("not implemented")}_getIdTokenResponse(e){return be("not implemented")}_linkToIdToken(e,t){return be("not implemented")}_getReauthenticationResolver(e){return be("not implemented")}}async function ut(i,e){return nh(i,"POST","/v1/accounts:signInWithIdp",Hi(i,e))}const Rh="http://localhost";class Qe extends jo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Qe(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Te("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r,...o}=t;if(!n||!r)return null;const c=new Qe(n,r);return c.idToken=o.idToken||void 0,c.accessToken=o.accessToken||void 0,c.secret=o.secret,c.nonce=o.nonce,c.pendingToken=o.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return ut(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ut(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ut(e,t)}buildRequest(){const e={requestUri:Rh,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=$t(t)}return e}}class Ho{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Gt extends Ho{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Oe extends Gt{constructor(){super("facebook.com")}static credential(e){return Qe._fromParams({providerId:Oe.PROVIDER_ID,signInMethod:Oe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Oe.credentialFromTaggedObject(e)}static credentialFromError(e){return Oe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Oe.credential(e.oauthAccessToken)}catch{return null}}}Oe.FACEBOOK_SIGN_IN_METHOD="facebook.com";Oe.PROVIDER_ID="facebook.com";class Le extends Gt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Qe._fromParams({providerId:Le.PROVIDER_ID,signInMethod:Le.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Le.credentialFromTaggedObject(e)}static credentialFromError(e){return Le.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Le.credential(t,n)}catch{return null}}}Le.GOOGLE_SIGN_IN_METHOD="google.com";Le.PROVIDER_ID="google.com";class xe extends Gt{constructor(){super("github.com")}static credential(e){return Qe._fromParams({providerId:xe.PROVIDER_ID,signInMethod:xe.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xe.credentialFromTaggedObject(e)}static credentialFromError(e){return xe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xe.credential(e.oauthAccessToken)}catch{return null}}}xe.GITHUB_SIGN_IN_METHOD="github.com";xe.PROVIDER_ID="github.com";class Me extends Gt{constructor(){super("twitter.com")}static credential(e,t){return Qe._fromParams({providerId:Me.PROVIDER_ID,signInMethod:Me.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Me.credentialFromTaggedObject(e)}static credentialFromError(e){return Me.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Me.credential(t,n)}catch{return null}}}Me.TWITTER_SIGN_IN_METHOD="twitter.com";Me.PROVIDER_ID="twitter.com";class ft{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const o=await re._fromIdTokenResponse(e,n,r),c=Sr(n);return new ft({user:o,providerId:c,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Sr(n);return new ft({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Sr(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}class Rn extends ve{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Rn.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Rn(e,t,n,r)}}function zo(i,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Rn._fromErrorAndOperation(i,o,e,n):o})}async function kh(i,e,t=!1){const n=await jt(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return ft._forOperation(i,"link",n)}async function Ph(i,e,t=!1){const{auth:n}=i;if(se(n.app))return Promise.reject(Ke(n));const r="reauthenticate";try{const o=await jt(i,zo(n,r,e,i),t);L(o.idToken,n,"internal-error");const c=zi(o.idToken);L(c,n,"internal-error");const{sub:h}=c;return L(i.uid===h,n,"user-mismatch"),ft._forOperation(i,r,o)}catch(o){throw o?.code==="auth/user-not-found"&&Te(n,"user-mismatch"),o}}async function Dh(i,e,t=!1){if(se(i.app))return Promise.reject(Ke(i));const n="signIn",r=await zo(i,n,e),o=await ft._fromIdTokenResponse(i,n,r);return t||await i._updateCurrentUser(o.user),o}function Nh(i,e,t,n){return tt(i).onIdTokenChanged(e,t,n)}function Oh(i,e,t){return tt(i).beforeAuthStateChanged(e,t)}const kn="__sak";class Wo{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kn,"1"),this.storage.removeItem(kn),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Lh=1e3,xh=10;class $o extends Wo{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Bo(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,h,d)=>{this.notifyListeners(c,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const c=this.storage.getItem(n);!t&&this.localCache[n]===c||this.notifyListeners(n,c)},o=this.storage.getItem(n);fh()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,xh):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Lh)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$o.type="LOCAL";const Mh=$o;class qo extends Wo{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}qo.type="SESSION";const Go=qo;function Uh(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class xn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const n=new xn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:o}=t.data,c=this.handlersMap[r];if(!c?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const h=Array.from(c).map(async f=>f(t.origin,o)),d=await Uh(h);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}xn.receivers=[];function Gi(i="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return i+t}class Bh{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let o,c;return new Promise((h,d)=>{const f=Gi("",20);r.port1.start();const y=setTimeout(()=>{d(new Error("unsupported_event"))},n);c={messageChannel:r,onMessage(I){const T=I;if(T.data.eventId===f)switch(T.data.status){case"ack":clearTimeout(y),o=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),h(T.data.response);break;default:clearTimeout(y),clearTimeout(o),d(new Error("invalid_response"));break}}},this.handlers.add(c),r.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[r.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function me(){return window}function Fh(i){me().location.href=i}function Ko(){return typeof me().WorkerGlobalScope<"u"&&typeof me().importScripts=="function"}async function Vh(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jh(){return navigator?.serviceWorker?.controller||null}function Hh(){return Ko()?self:null}const Xo="firebaseLocalStorageDb",zh=1,Pn="firebaseLocalStorage",Jo="fbase_key";class Kt{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Mn(i,e){return i.transaction([Pn],e?"readwrite":"readonly").objectStore(Pn)}function Wh(){const i=indexedDB.deleteDatabase(Xo);return new Kt(i).toPromise()}function Di(){const i=indexedDB.open(Xo,zh);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const n=i.result;try{n.createObjectStore(Pn,{keyPath:Jo})}catch(r){t(r)}}),i.addEventListener("success",async()=>{const n=i.result;n.objectStoreNames.contains(Pn)?e(n):(n.close(),await Wh(),e(await Di()))})})}async function Ar(i,e,t){const n=Mn(i,!0).put({[Jo]:e,value:t});return new Kt(n).toPromise()}async function $h(i,e){const t=Mn(i,!1).get(e),n=await new Kt(t).toPromise();return n===void 0?null:n.value}function Rr(i,e){const t=Mn(i,!0).delete(e);return new Kt(t).toPromise()}const qh=800,Gh=3;class Yo{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Di(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>Gh)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ko()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=xn._getInstance(Hh()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Vh(),!this.activeServiceWorker)return;this.sender=new Bh(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||jh()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Di();return await Ar(e,kn,"1"),await Rr(e,kn),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Ar(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>$h(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Rr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const o=Mn(r,!1).getAll();return new Kt(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:o}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qh)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Yo.type="LOCAL";const Kh=Yo;new qt(3e4,6e4);function Xh(i,e){return e?Ee(e):(L(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class Ki extends jo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ut(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ut(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ut(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jh(i){return Dh(i.auth,new Ki(i),i.bypassAuthState)}function Yh(i){const{auth:e,user:t}=i;return L(t,e,"internal-error"),Ph(t,new Ki(i),i.bypassAuthState)}async function Zh(i){const{auth:e,user:t}=i;return L(t,e,"internal-error"),kh(t,new Ki(i),i.bypassAuthState)}class Zo{constructor(e,t,n,r,o=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:o,error:c,type:h}=e;if(c){this.reject(c);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(d))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jh;case"linkViaPopup":case"linkViaRedirect":return Zh;case"reauthViaPopup":case"reauthViaRedirect":return Yh;default:Te(this.auth,"internal-error")}}resolve(e){Ce(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ce(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Qh=new qt(2e3,1e4);class ct extends Zo{constructor(e,t,n,r,o){super(e,t,r,o),this.provider=n,this.authWindow=null,this.pollId=null,ct.currentPopupAction&&ct.currentPopupAction.cancel(),ct.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return L(e,this.auth,"internal-error"),e}async onExecution(){Ce(this.filter.length===1,"Popup operations only handle one event");const e=Gi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ge(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ge(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ct.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ge(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Qh.get())};e()}}ct.currentPopupAction=null;const eu="pendingRedirect",wn=new Map;class tu extends Zo{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=wn.get(this.auth._key());if(!e){try{const n=await nu(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}wn.set(this.auth._key(),e)}return this.bypassAuthState||wn.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nu(i,e){const t=ru(e),n=su(i);if(!await n._isAvailable())return!1;const r=await n._get(t)==="true";return await n._remove(t),r}function iu(i,e){wn.set(i._key(),e)}function su(i){return Ee(i._redirectPersistence)}function ru(i){return _n(eu,i.config.apiKey,i.name)}async function ou(i,e,t=!1){if(se(i.app))return Promise.reject(Ke(i));const n=$i(i),r=Xh(n,e),c=await new tu(n,r,t).execute();return c&&!t&&(delete c.user._redirectEventId,await n._persistUserIfCurrent(c.user),await n._setRedirectUser(null,e)),c}const au=600*1e3;class cu{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lu(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Qo(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ge(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=au&&this.cachedEventUids.clear(),this.cachedEventUids.has(kr(e))}saveEventToCache(e){this.cachedEventUids.add(kr(e)),this.lastProcessedEventTime=Date.now()}}function kr(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function Qo({type:i,error:e}){return i==="unknown"&&e?.code==="auth/no-auth-event"}function lu(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qo(i);default:return!1}}async function hu(i,e={}){return mt(i,"GET","/v1/projects",e)}const uu=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,du=/^https?/;async function fu(i){if(i.config.emulator)return;const{authorizedDomains:e}=await hu(i);for(const t of e)try{if(pu(t))return}catch{}Te(i,"unauthorized-domain")}function pu(i){const e=ki(),{protocol:t,hostname:n}=new URL(e);if(i.startsWith("chrome-extension://")){const c=new URL(i);return c.hostname===""&&n===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===n}if(!du.test(t))return!1;if(uu.test(i))return n===i;const r=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const gu=new qt(3e4,6e4);function Pr(){const i=me().___jsl;if(i?.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function mu(i){return new Promise((e,t)=>{function n(){Pr(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Pr(),t(ge(i,"network-request-failed"))},timeout:gu.get()})}if(me().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(me().gapi?.load)n();else{const r=Eh("iframefcb");return me()[r]=()=>{gapi.load?n():t(ge(i,"network-request-failed"))},wh(`${bh()}?onload=${r}`).catch(o=>t(o))}}).catch(e=>{throw bn=null,e})}let bn=null;function yu(i){return bn=bn||mu(i),bn}const vu=new qt(5e3,15e3),_u="__/auth/iframe",wu="emulator/auth/iframe",bu={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Eu=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Iu(i){const e=i.config;L(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?ji(e,wu):`https://${i.config.authDomain}/${_u}`,n={apiKey:e.apiKey,appName:i.name,v:nt},r=Eu.get(i.config.apiHost);r&&(n.eid=r);const o=i._getFrameworks();return o.length&&(n.fw=o.join(",")),`${t}?${$t(n).slice(1)}`}async function Tu(i){const e=await yu(i),t=me().gapi;return L(t,i,"internal-error"),e.open({where:document.body,url:Iu(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bu,dontclear:!0},n=>new Promise(async(r,o)=>{await n.restyle({setHideOnLeave:!1});const c=ge(i,"network-request-failed"),h=me().setTimeout(()=>{o(c)},vu.get());function d(){me().clearTimeout(h),r(n)}n.ping(d).then(d,()=>{o(c)})}))}const Cu={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Su=500,Au=600,Ru="_blank",ku="http://localhost";class Dr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Pu(i,e,t,n=Su,r=Au){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),c=Math.max((window.screen.availWidth-n)/2,0).toString();let h="";const d={...Cu,width:n.toString(),height:r.toString(),top:o,left:c},f=te().toLowerCase();t&&(h=Oo(f)?Ru:t),Do(f)&&(e=e||ku,d.scrollbars="yes");const y=Object.entries(d).reduce((T,[S,A])=>`${T}${S}=${A},`,"");if(dh(f)&&h!=="_self")return Du(e||"",h),new Dr(null);const I=window.open(e||"",h,y);L(I,i,"popup-blocked");try{I.focus()}catch{}return new Dr(I)}function Du(i,e){const t=document.createElement("a");t.href=i,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}const Nu="__/auth/handler",Ou="emulator/auth/handler",Lu=encodeURIComponent("fac");async function Nr(i,e,t,n,r,o){L(i.config.authDomain,i,"auth-domain-config-required"),L(i.config.apiKey,i,"invalid-api-key");const c={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:n,v:nt,eventId:r};if(e instanceof Ho){e.setDefaultLanguage(i.languageCode),c.providerId=e.providerId||"",Mc(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[y,I]of Object.entries({}))c[y]=I}if(e instanceof Gt){const y=e.getScopes().filter(I=>I!=="");y.length>0&&(c.scopes=y.join(","))}i.tenantId&&(c.tid=i.tenantId);const h=c;for(const y of Object.keys(h))h[y]===void 0&&delete h[y];const d=await i._getAppCheckToken(),f=d?`#${Lu}=${encodeURIComponent(d)}`:"";return`${xu(i)}?${$t(h).slice(1)}${f}`}function xu({config:i}){return i.emulator?ji(i,Ou):`https://${i.authDomain}/${Nu}`}const _i="webStorageSupport";class Mu{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Go,this._completeRedirectFn=ou,this._overrideRedirectResult=iu}async _openPopup(e,t,n,r){Ce(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Nr(e,t,n,ki(),r);return Pu(e,o,Gi())}async _openRedirect(e,t,n,r){await this._originValidation(e);const o=await Nr(e,t,n,ki(),r);return Fh(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:o}=this.eventManagers[t];return r?Promise.resolve(r):(Ce(o,"If manager is not set, promise should be"),o)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Tu(e),n=new cu(e);return t.register("authEvent",r=>(L(r?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_i,{type:_i},r=>{const o=r?.[0]?.[_i];o!==void 0&&t(!!o),Te(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=fu(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Bo()||No()||Wi()}}const Uu=Mu;var Or="@firebase/auth",Lr="1.11.1";class Bu{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Fu(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Vu(i){Ze(new Fe("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:c,authDomain:h}=n.options;L(c&&!c.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:c,authDomain:h,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Fo(i)},f=new vh(n,r,o,d);return Th(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Ze(new Fe("auth-internal",e=>{const t=$i(e.getProvider("auth").getImmediate());return(n=>new Bu(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),pe(Or,Lr,Fu(i)),pe(Or,Lr,"esm2020")}const ju=300,Hu=mo("authIdTokenMaxAge")||ju;let xr=null;const zu=i=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Hu)return;const r=t?.token;xr!==r&&(xr=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Wu(i=Fi()){const e=Ln(i,"auth");if(e.isInitialized())return e.getImmediate();const t=Ih(i,{popupRedirectResolver:Uu,persistence:[Kh,Mh,Go]}),n=mo("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(n,location.origin);if(location.origin===o.origin){const c=zu(o.toString());Oh(t,c,()=>c(t.currentUser)),Nh(t,h=>c(h))}}const r=fo("auth");return r&&Ch(t,`http://${r}`),t}function $u(){return document.getElementsByTagName("head")?.[0]??document}_h({loadJS(i){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",i),n.onload=e,n.onerror=r=>{const o=ge("internal-error");o.customData=r,t(o)},n.type="text/javascript",n.charset="UTF-8",$u().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Vu("Browser");var qu="firebase",Gu="12.6.0";pe(qu,Gu,"app");var Mr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Xi;(function(){var i;function e(v,p){function g(){}g.prototype=p.prototype,v.F=p.prototype,v.prototype=new g,v.prototype.constructor=v,v.D=function(w,_,b){for(var m=Array(arguments.length-2),X=2;X<arguments.length;X++)m[X-2]=arguments[X];return p.prototype[_].apply(w,m)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(v,p,g){g||(g=0);const w=Array(16);if(typeof p=="string")for(var _=0;_<16;++_)w[_]=p.charCodeAt(g++)|p.charCodeAt(g++)<<8|p.charCodeAt(g++)<<16|p.charCodeAt(g++)<<24;else for(_=0;_<16;++_)w[_]=p[g++]|p[g++]<<8|p[g++]<<16|p[g++]<<24;p=v.g[0],g=v.g[1],_=v.g[2];let b=v.g[3],m;m=p+(b^g&(_^b))+w[0]+3614090360&4294967295,p=g+(m<<7&4294967295|m>>>25),m=b+(_^p&(g^_))+w[1]+3905402710&4294967295,b=p+(m<<12&4294967295|m>>>20),m=_+(g^b&(p^g))+w[2]+606105819&4294967295,_=b+(m<<17&4294967295|m>>>15),m=g+(p^_&(b^p))+w[3]+3250441966&4294967295,g=_+(m<<22&4294967295|m>>>10),m=p+(b^g&(_^b))+w[4]+4118548399&4294967295,p=g+(m<<7&4294967295|m>>>25),m=b+(_^p&(g^_))+w[5]+1200080426&4294967295,b=p+(m<<12&4294967295|m>>>20),m=_+(g^b&(p^g))+w[6]+2821735955&4294967295,_=b+(m<<17&4294967295|m>>>15),m=g+(p^_&(b^p))+w[7]+4249261313&4294967295,g=_+(m<<22&4294967295|m>>>10),m=p+(b^g&(_^b))+w[8]+1770035416&4294967295,p=g+(m<<7&4294967295|m>>>25),m=b+(_^p&(g^_))+w[9]+2336552879&4294967295,b=p+(m<<12&4294967295|m>>>20),m=_+(g^b&(p^g))+w[10]+4294925233&4294967295,_=b+(m<<17&4294967295|m>>>15),m=g+(p^_&(b^p))+w[11]+2304563134&4294967295,g=_+(m<<22&4294967295|m>>>10),m=p+(b^g&(_^b))+w[12]+1804603682&4294967295,p=g+(m<<7&4294967295|m>>>25),m=b+(_^p&(g^_))+w[13]+4254626195&4294967295,b=p+(m<<12&4294967295|m>>>20),m=_+(g^b&(p^g))+w[14]+2792965006&4294967295,_=b+(m<<17&4294967295|m>>>15),m=g+(p^_&(b^p))+w[15]+1236535329&4294967295,g=_+(m<<22&4294967295|m>>>10),m=p+(_^b&(g^_))+w[1]+4129170786&4294967295,p=g+(m<<5&4294967295|m>>>27),m=b+(g^_&(p^g))+w[6]+3225465664&4294967295,b=p+(m<<9&4294967295|m>>>23),m=_+(p^g&(b^p))+w[11]+643717713&4294967295,_=b+(m<<14&4294967295|m>>>18),m=g+(b^p&(_^b))+w[0]+3921069994&4294967295,g=_+(m<<20&4294967295|m>>>12),m=p+(_^b&(g^_))+w[5]+3593408605&4294967295,p=g+(m<<5&4294967295|m>>>27),m=b+(g^_&(p^g))+w[10]+38016083&4294967295,b=p+(m<<9&4294967295|m>>>23),m=_+(p^g&(b^p))+w[15]+3634488961&4294967295,_=b+(m<<14&4294967295|m>>>18),m=g+(b^p&(_^b))+w[4]+3889429448&4294967295,g=_+(m<<20&4294967295|m>>>12),m=p+(_^b&(g^_))+w[9]+568446438&4294967295,p=g+(m<<5&4294967295|m>>>27),m=b+(g^_&(p^g))+w[14]+3275163606&4294967295,b=p+(m<<9&4294967295|m>>>23),m=_+(p^g&(b^p))+w[3]+4107603335&4294967295,_=b+(m<<14&4294967295|m>>>18),m=g+(b^p&(_^b))+w[8]+1163531501&4294967295,g=_+(m<<20&4294967295|m>>>12),m=p+(_^b&(g^_))+w[13]+2850285829&4294967295,p=g+(m<<5&4294967295|m>>>27),m=b+(g^_&(p^g))+w[2]+4243563512&4294967295,b=p+(m<<9&4294967295|m>>>23),m=_+(p^g&(b^p))+w[7]+1735328473&4294967295,_=b+(m<<14&4294967295|m>>>18),m=g+(b^p&(_^b))+w[12]+2368359562&4294967295,g=_+(m<<20&4294967295|m>>>12),m=p+(g^_^b)+w[5]+4294588738&4294967295,p=g+(m<<4&4294967295|m>>>28),m=b+(p^g^_)+w[8]+2272392833&4294967295,b=p+(m<<11&4294967295|m>>>21),m=_+(b^p^g)+w[11]+1839030562&4294967295,_=b+(m<<16&4294967295|m>>>16),m=g+(_^b^p)+w[14]+4259657740&4294967295,g=_+(m<<23&4294967295|m>>>9),m=p+(g^_^b)+w[1]+2763975236&4294967295,p=g+(m<<4&4294967295|m>>>28),m=b+(p^g^_)+w[4]+1272893353&4294967295,b=p+(m<<11&4294967295|m>>>21),m=_+(b^p^g)+w[7]+4139469664&4294967295,_=b+(m<<16&4294967295|m>>>16),m=g+(_^b^p)+w[10]+3200236656&4294967295,g=_+(m<<23&4294967295|m>>>9),m=p+(g^_^b)+w[13]+681279174&4294967295,p=g+(m<<4&4294967295|m>>>28),m=b+(p^g^_)+w[0]+3936430074&4294967295,b=p+(m<<11&4294967295|m>>>21),m=_+(b^p^g)+w[3]+3572445317&4294967295,_=b+(m<<16&4294967295|m>>>16),m=g+(_^b^p)+w[6]+76029189&4294967295,g=_+(m<<23&4294967295|m>>>9),m=p+(g^_^b)+w[9]+3654602809&4294967295,p=g+(m<<4&4294967295|m>>>28),m=b+(p^g^_)+w[12]+3873151461&4294967295,b=p+(m<<11&4294967295|m>>>21),m=_+(b^p^g)+w[15]+530742520&4294967295,_=b+(m<<16&4294967295|m>>>16),m=g+(_^b^p)+w[2]+3299628645&4294967295,g=_+(m<<23&4294967295|m>>>9),m=p+(_^(g|~b))+w[0]+4096336452&4294967295,p=g+(m<<6&4294967295|m>>>26),m=b+(g^(p|~_))+w[7]+1126891415&4294967295,b=p+(m<<10&4294967295|m>>>22),m=_+(p^(b|~g))+w[14]+2878612391&4294967295,_=b+(m<<15&4294967295|m>>>17),m=g+(b^(_|~p))+w[5]+4237533241&4294967295,g=_+(m<<21&4294967295|m>>>11),m=p+(_^(g|~b))+w[12]+1700485571&4294967295,p=g+(m<<6&4294967295|m>>>26),m=b+(g^(p|~_))+w[3]+2399980690&4294967295,b=p+(m<<10&4294967295|m>>>22),m=_+(p^(b|~g))+w[10]+4293915773&4294967295,_=b+(m<<15&4294967295|m>>>17),m=g+(b^(_|~p))+w[1]+2240044497&4294967295,g=_+(m<<21&4294967295|m>>>11),m=p+(_^(g|~b))+w[8]+1873313359&4294967295,p=g+(m<<6&4294967295|m>>>26),m=b+(g^(p|~_))+w[15]+4264355552&4294967295,b=p+(m<<10&4294967295|m>>>22),m=_+(p^(b|~g))+w[6]+2734768916&4294967295,_=b+(m<<15&4294967295|m>>>17),m=g+(b^(_|~p))+w[13]+1309151649&4294967295,g=_+(m<<21&4294967295|m>>>11),m=p+(_^(g|~b))+w[4]+4149444226&4294967295,p=g+(m<<6&4294967295|m>>>26),m=b+(g^(p|~_))+w[11]+3174756917&4294967295,b=p+(m<<10&4294967295|m>>>22),m=_+(p^(b|~g))+w[2]+718787259&4294967295,_=b+(m<<15&4294967295|m>>>17),m=g+(b^(_|~p))+w[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(_+(m<<21&4294967295|m>>>11))&4294967295,v.g[2]=v.g[2]+_&4294967295,v.g[3]=v.g[3]+b&4294967295}n.prototype.v=function(v,p){p===void 0&&(p=v.length);const g=p-this.blockSize,w=this.C;let _=this.h,b=0;for(;b<p;){if(_==0)for(;b<=g;)r(this,v,b),b+=this.blockSize;if(typeof v=="string"){for(;b<p;)if(w[_++]=v.charCodeAt(b++),_==this.blockSize){r(this,w),_=0;break}}else for(;b<p;)if(w[_++]=v[b++],_==this.blockSize){r(this,w),_=0;break}}this.h=_,this.o+=p},n.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;p=this.o*8;for(var g=v.length-8;g<v.length;++g)v[g]=p&255,p/=256;for(this.v(v),v=Array(16),p=0,g=0;g<4;++g)for(let w=0;w<32;w+=8)v[p++]=this.g[g]>>>w&255;return v};function o(v,p){var g=h;return Object.prototype.hasOwnProperty.call(g,v)?g[v]:g[v]=p(v)}function c(v,p){this.h=p;const g=[];let w=!0;for(let _=v.length-1;_>=0;_--){const b=v[_]|0;w&&b==p||(g[_]=b,w=!1)}this.g=g}var h={};function d(v){return-128<=v&&v<128?o(v,function(p){return new c([p|0],p<0?-1:0)}):new c([v|0],v<0?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return I;if(v<0)return R(f(-v));const p=[];let g=1;for(let w=0;v>=g;w++)p[w]=v/g|0,g*=4294967296;return new c(p,0)}function y(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return R(y(v.substring(1),p));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const g=f(Math.pow(p,8));let w=I;for(let b=0;b<v.length;b+=8){var _=Math.min(8,v.length-b);const m=parseInt(v.substring(b,b+_),p);_<8?(_=f(Math.pow(p,_)),w=w.j(_).add(f(m))):(w=w.j(g),w=w.add(f(m)))}return w}var I=d(0),T=d(1),S=d(16777216);i=c.prototype,i.m=function(){if(P(this))return-R(this).m();let v=0,p=1;for(let g=0;g<this.g.length;g++){const w=this.i(g);v+=(w>=0?w:4294967296+w)*p,p*=4294967296}return v},i.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(A(this))return"0";if(P(this))return"-"+R(this).toString(v);const p=f(Math.pow(v,6));var g=this;let w="";for(;;){const _=B(g,p).g;g=D(g,_.j(p));let b=((g.g.length>0?g.g[0]:g.h)>>>0).toString(v);if(g=_,A(g))return b+w;for(;b.length<6;)b="0"+b;w=b+w}},i.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function A(v){if(v.h!=0)return!1;for(let p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function P(v){return v.h==-1}i.l=function(v){return v=D(this,v),P(v)?-1:A(v)?0:1};function R(v){const p=v.g.length,g=[];for(let w=0;w<p;w++)g[w]=~v.g[w];return new c(g,~v.h).add(T)}i.abs=function(){return P(this)?R(this):this},i.add=function(v){const p=Math.max(this.g.length,v.g.length),g=[];let w=0;for(let _=0;_<=p;_++){let b=w+(this.i(_)&65535)+(v.i(_)&65535),m=(b>>>16)+(this.i(_)>>>16)+(v.i(_)>>>16);w=m>>>16,b&=65535,m&=65535,g[_]=m<<16|b}return new c(g,g[g.length-1]&-2147483648?-1:0)};function D(v,p){return v.add(R(p))}i.j=function(v){if(A(this)||A(v))return I;if(P(this))return P(v)?R(this).j(R(v)):R(R(this).j(v));if(P(v))return R(this.j(R(v)));if(this.l(S)<0&&v.l(S)<0)return f(this.m()*v.m());const p=this.g.length+v.g.length,g=[];for(var w=0;w<2*p;w++)g[w]=0;for(w=0;w<this.g.length;w++)for(let _=0;_<v.g.length;_++){const b=this.i(w)>>>16,m=this.i(w)&65535,X=v.i(_)>>>16,ce=v.i(_)&65535;g[2*w+2*_]+=m*ce,x(g,2*w+2*_),g[2*w+2*_+1]+=b*ce,x(g,2*w+2*_+1),g[2*w+2*_+1]+=m*X,x(g,2*w+2*_+1),g[2*w+2*_+2]+=b*X,x(g,2*w+2*_+2)}for(v=0;v<p;v++)g[v]=g[2*v+1]<<16|g[2*v];for(v=p;v<2*p;v++)g[v]=0;return new c(g,0)};function x(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function U(v,p){this.g=v,this.h=p}function B(v,p){if(A(p))throw Error("division by zero");if(A(v))return new U(I,I);if(P(v))return p=B(R(v),p),new U(R(p.g),R(p.h));if(P(p))return p=B(v,R(p)),new U(R(p.g),p.h);if(v.g.length>30){if(P(v)||P(p))throw Error("slowDivide_ only works with positive integers.");for(var g=T,w=p;w.l(v)<=0;)g=O(g),w=O(w);var _=N(g,1),b=N(w,1);for(w=N(w,2),g=N(g,2);!A(w);){var m=b.add(w);m.l(v)<=0&&(_=_.add(g),b=m),w=N(w,1),g=N(g,1)}return p=D(v,_.j(p)),new U(_,p)}for(_=I;v.l(p)>=0;){for(g=Math.max(1,Math.floor(v.m()/p.m())),w=Math.ceil(Math.log(g)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),b=f(g),m=b.j(p);P(m)||m.l(v)>0;)g-=w,b=f(g),m=b.j(p);A(b)&&(b=T),_=_.add(b),v=D(v,m)}return new U(_,v)}i.B=function(v){return B(this,v).h},i.and=function(v){const p=Math.max(this.g.length,v.g.length),g=[];for(let w=0;w<p;w++)g[w]=this.i(w)&v.i(w);return new c(g,this.h&v.h)},i.or=function(v){const p=Math.max(this.g.length,v.g.length),g=[];for(let w=0;w<p;w++)g[w]=this.i(w)|v.i(w);return new c(g,this.h|v.h)},i.xor=function(v){const p=Math.max(this.g.length,v.g.length),g=[];for(let w=0;w<p;w++)g[w]=this.i(w)^v.i(w);return new c(g,this.h^v.h)};function O(v){const p=v.g.length+1,g=[];for(let w=0;w<p;w++)g[w]=v.i(w)<<1|v.i(w-1)>>>31;return new c(g,v.h)}function N(v,p){const g=p>>5;p%=32;const w=v.g.length-g,_=[];for(let b=0;b<w;b++)_[b]=p>0?v.i(b+g)>>>p|v.i(b+g+1)<<32-p:v.i(b+g);return new c(_,v.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=y,Xi=c}).apply(typeof Mr<"u"?Mr:typeof self<"u"?self:typeof window<"u"?window:{});var dn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var i,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof dn=="object"&&dn];for(var a=0;a<s.length;++a){var l=s[a];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var n=t(this);function r(s,a){if(a)e:{var l=n;s=s.split(".");for(var u=0;u<s.length-1;u++){var E=s[u];if(!(E in l))break e;l=l[E]}s=s[s.length-1],u=l[s],a=a(u),a!=u&&a!=null&&e(l,s,{configurable:!0,writable:!0,value:a})}}r("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(s){return s||function(a){var l=[],u;for(u in a)Object.prototype.hasOwnProperty.call(a,u)&&l.push([u,a[u]]);return l}});var o=o||{},c=this||self;function h(s){var a=typeof s;return a=="object"&&s!=null||a=="function"}function d(s,a,l){return s.call.apply(s.bind,arguments)}function f(s,a,l){return f=d,f.apply(null,arguments)}function y(s,a){var l=Array.prototype.slice.call(arguments,1);return function(){var u=l.slice();return u.push.apply(u,arguments),s.apply(this,u)}}function I(s,a){function l(){}l.prototype=a.prototype,s.Z=a.prototype,s.prototype=new l,s.prototype.constructor=s,s.Ob=function(u,E,C){for(var k=Array(arguments.length-2),M=2;M<arguments.length;M++)k[M-2]=arguments[M];return a.prototype[E].apply(u,k)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function S(s){const a=s.length;if(a>0){const l=Array(a);for(let u=0;u<a;u++)l[u]=s[u];return l}return[]}function A(s,a){for(let u=1;u<arguments.length;u++){const E=arguments[u];var l=typeof E;if(l=l!="object"?l:E?Array.isArray(E)?"array":l:"null",l=="array"||l=="object"&&typeof E.length=="number"){l=s.length||0;const C=E.length||0;s.length=l+C;for(let k=0;k<C;k++)s[l+k]=E[k]}else s.push(E)}}class P{constructor(a,l){this.i=a,this.j=l,this.h=0,this.g=null}get(){let a;return this.h>0?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function R(s){c.setTimeout(()=>{throw s},0)}function D(){var s=v;let a=null;return s.g&&(a=s.g,s.g=s.g.next,s.g||(s.h=null),a.next=null),a}class x{constructor(){this.h=this.g=null}add(a,l){const u=U.get();u.set(a,l),this.h?this.h.next=u:this.g=u,this.h=u}}var U=new P(()=>new B,s=>s.reset());class B{constructor(){this.next=this.g=this.h=null}set(a,l){this.h=a,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let O,N=!1,v=new x,p=()=>{const s=Promise.resolve(void 0);O=()=>{s.then(g)}};function g(){for(var s;s=D();){try{s.h.call(s.g)}catch(l){R(l)}var a=U;a.j(s),a.h<100&&(a.h++,s.next=a.g,a.g=s)}N=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(s,a){this.type=s,this.g=this.target=a,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var s=!1,a=Object.defineProperty({},"passive",{get:function(){s=!0}});try{const l=()=>{};c.addEventListener("test",l,a),c.removeEventListener("test",l,a)}catch{}return s})();function m(s){return/^[\s\xa0]*$/.test(s)}function X(s,a){_.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,a)}I(X,_),X.prototype.init=function(s,a){const l=this.type=s.type,u=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=a,a=s.relatedTarget,a||(l=="mouseover"?a=s.fromElement:l=="mouseout"&&(a=s.toElement)),this.relatedTarget=a,u?(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&X.Z.h.call(this)},X.prototype.h=function(){X.Z.h.call(this);const s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var ce="closure_listenable_"+(Math.random()*1e6|0),Un=0;function Yt(s,a,l,u,E){this.listener=s,this.proxy=null,this.src=a,this.type=l,this.capture=!!u,this.ha=E,this.key=++Un,this.da=this.fa=!1}function it(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Zt(s,a,l){for(const u in s)a.call(l,s[u],u,s)}function ua(s,a){for(const l in s)a.call(void 0,s[l],l,s)}function ts(s){const a={};for(const l in s)a[l]=s[l];return a}const ns="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function is(s,a){let l,u;for(let E=1;E<arguments.length;E++){u=arguments[E];for(l in u)s[l]=u[l];for(let C=0;C<ns.length;C++)l=ns[C],Object.prototype.hasOwnProperty.call(u,l)&&(s[l]=u[l])}}function Qt(s){this.src=s,this.g={},this.h=0}Qt.prototype.add=function(s,a,l,u,E){const C=s.toString();s=this.g[C],s||(s=this.g[C]=[],this.h++);const k=Fn(s,a,u,E);return k>-1?(a=s[k],l||(a.fa=!1)):(a=new Yt(a,this.src,C,!!u,E),a.fa=l,s.push(a)),a};function Bn(s,a){const l=a.type;if(l in s.g){var u=s.g[l],E=Array.prototype.indexOf.call(u,a,void 0),C;(C=E>=0)&&Array.prototype.splice.call(u,E,1),C&&(it(a),s.g[l].length==0&&(delete s.g[l],s.h--))}}function Fn(s,a,l,u){for(let E=0;E<s.length;++E){const C=s[E];if(!C.da&&C.listener==a&&C.capture==!!l&&C.ha==u)return E}return-1}var Vn="closure_lm_"+(Math.random()*1e6|0),jn={};function ss(s,a,l,u,E){if(Array.isArray(a)){for(let C=0;C<a.length;C++)ss(s,a[C],l,u,E);return null}return l=as(l),s&&s[ce]?s.J(a,l,h(u)?!!u.capture:!1,E):da(s,a,l,!1,u,E)}function da(s,a,l,u,E,C){if(!a)throw Error("Invalid event type");const k=h(E)?!!E.capture:!!E;let M=zn(s);if(M||(s[Vn]=M=new Qt(s)),l=M.add(a,l,u,k,C),l.proxy)return l;if(u=fa(),l.proxy=u,u.src=s,u.listener=l,s.addEventListener)b||(E=k),E===void 0&&(E=!1),s.addEventListener(a.toString(),u,E);else if(s.attachEvent)s.attachEvent(os(a.toString()),u);else if(s.addListener&&s.removeListener)s.addListener(u);else throw Error("addEventListener and attachEvent are unavailable.");return l}function fa(){function s(l){return a.call(s.src,s.listener,l)}const a=pa;return s}function rs(s,a,l,u,E){if(Array.isArray(a))for(var C=0;C<a.length;C++)rs(s,a[C],l,u,E);else u=h(u)?!!u.capture:!!u,l=as(l),s&&s[ce]?(s=s.i,C=String(a).toString(),C in s.g&&(a=s.g[C],l=Fn(a,l,u,E),l>-1&&(it(a[l]),Array.prototype.splice.call(a,l,1),a.length==0&&(delete s.g[C],s.h--)))):s&&(s=zn(s))&&(a=s.g[a.toString()],s=-1,a&&(s=Fn(a,l,u,E)),(l=s>-1?a[s]:null)&&Hn(l))}function Hn(s){if(typeof s!="number"&&s&&!s.da){var a=s.src;if(a&&a[ce])Bn(a.i,s);else{var l=s.type,u=s.proxy;a.removeEventListener?a.removeEventListener(l,u,s.capture):a.detachEvent?a.detachEvent(os(l),u):a.addListener&&a.removeListener&&a.removeListener(u),(l=zn(a))?(Bn(l,s),l.h==0&&(l.src=null,a[Vn]=null)):it(s)}}}function os(s){return s in jn?jn[s]:jn[s]="on"+s}function pa(s,a){if(s.da)s=!0;else{a=new X(a,this);const l=s.listener,u=s.ha||s.src;s.fa&&Hn(s),s=l.call(u,a)}return s}function zn(s){return s=s[Vn],s instanceof Qt?s:null}var Wn="__closure_events_fn_"+(Math.random()*1e9>>>0);function as(s){return typeof s=="function"?s:(s[Wn]||(s[Wn]=function(a){return s.handleEvent(a)}),s[Wn])}function J(){w.call(this),this.i=new Qt(this),this.M=this,this.G=null}I(J,w),J.prototype[ce]=!0,J.prototype.removeEventListener=function(s,a,l,u){rs(this,s,a,l,u)};function Y(s,a){var l,u=s.G;if(u)for(l=[];u;u=u.G)l.push(u);if(s=s.M,u=a.type||a,typeof a=="string")a=new _(a,s);else if(a instanceof _)a.target=a.target||s;else{var E=a;a=new _(u,s),is(a,E)}E=!0;let C,k;if(l)for(k=l.length-1;k>=0;k--)C=a.g=l[k],E=en(C,u,!0,a)&&E;if(C=a.g=s,E=en(C,u,!0,a)&&E,E=en(C,u,!1,a)&&E,l)for(k=0;k<l.length;k++)C=a.g=l[k],E=en(C,u,!1,a)&&E}J.prototype.N=function(){if(J.Z.N.call(this),this.i){var s=this.i;for(const a in s.g){const l=s.g[a];for(let u=0;u<l.length;u++)it(l[u]);delete s.g[a],s.h--}}this.G=null},J.prototype.J=function(s,a,l,u){return this.i.add(String(s),a,!1,l,u)},J.prototype.K=function(s,a,l,u){return this.i.add(String(s),a,!0,l,u)};function en(s,a,l,u){if(a=s.i.g[String(a)],!a)return!0;a=a.concat();let E=!0;for(let C=0;C<a.length;++C){const k=a[C];if(k&&!k.da&&k.capture==l){const M=k.listener,G=k.ha||k.src;k.fa&&Bn(s.i,k),E=M.call(G,u)!==!1&&E}}return E&&!u.defaultPrevented}function ga(s,a){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=f(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(a)>2147483647?-1:c.setTimeout(s,a||0)}function cs(s){s.g=ga(()=>{s.g=null,s.i&&(s.i=!1,cs(s))},s.l);const a=s.h;s.h=null,s.m.apply(null,a)}class ma extends w{constructor(a,l){super(),this.m=a,this.l=l,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:cs(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function yt(s){w.call(this),this.h=s,this.g={}}I(yt,w);var ls=[];function hs(s){Zt(s.g,function(a,l){this.g.hasOwnProperty(l)&&Hn(a)},s),s.g={}}yt.prototype.N=function(){yt.Z.N.call(this),hs(this)},yt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $n=c.JSON.stringify,ya=c.JSON.parse,va=class{stringify(s){return c.JSON.stringify(s,void 0)}parse(s){return c.JSON.parse(s,void 0)}};function us(){}function _a(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function qn(){_.call(this,"d")}I(qn,_);function Gn(){_.call(this,"c")}I(Gn,_);var st={},ds=null;function Kn(){return ds=ds||new J}st.Ia="serverreachability";function fs(s){_.call(this,st.Ia,s)}I(fs,_);function _t(s){const a=Kn();Y(a,new fs(a))}st.STAT_EVENT="statevent";function ps(s,a){_.call(this,st.STAT_EVENT,s),this.stat=a}I(ps,_);function Z(s){const a=Kn();Y(a,new ps(a,s))}st.Ja="timingevent";function gs(s,a){_.call(this,st.Ja,s),this.size=a}I(gs,_);function wt(s,a){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){s()},a)}function bt(){this.g=!0}bt.prototype.ua=function(){this.g=!1};function wa(s,a,l,u,E,C){s.info(function(){if(s.g)if(C){var k="",M=C.split("&");for(let z=0;z<M.length;z++){var G=M[z].split("=");if(G.length>1){const K=G[0];G=G[1];const he=K.split("_");k=he.length>=2&&he[1]=="type"?k+(K+"="+G+"&"):k+(K+"=redacted&")}}}else k=null;else k=C;return"XMLHTTP REQ ("+u+") [attempt "+E+"]: "+a+`
`+l+`
`+k})}function ba(s,a,l,u,E,C,k){s.info(function(){return"XMLHTTP RESP ("+u+") [ attempt "+E+"]: "+a+`
`+l+`
`+C+" "+k})}function rt(s,a,l,u){s.info(function(){return"XMLHTTP TEXT ("+a+"): "+Ia(s,l)+(u?" "+u:"")})}function Ea(s,a){s.info(function(){return"TIMEOUT: "+a})}bt.prototype.info=function(){};function Ia(s,a){if(!s.g)return a;if(!a)return null;try{const C=JSON.parse(a);if(C){for(s=0;s<C.length;s++)if(Array.isArray(C[s])){var l=C[s];if(!(l.length<2)){var u=l[1];if(Array.isArray(u)&&!(u.length<1)){var E=u[0];if(E!="noop"&&E!="stop"&&E!="close")for(let k=1;k<u.length;k++)u[k]=""}}}}return $n(C)}catch{return a}}var Xn={NO_ERROR:0,TIMEOUT:8},Ta={},ms;function Jn(){}I(Jn,us),Jn.prototype.g=function(){return new XMLHttpRequest},ms=new Jn;function Et(s){return encodeURIComponent(String(s))}function Ca(s){var a=1;s=s.split(":");const l=[];for(;a>0&&s.length;)l.push(s.shift()),a--;return s.length&&l.push(s.join(":")),l}function Se(s,a,l,u){this.j=s,this.i=a,this.l=l,this.S=u||1,this.V=new yt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ys}function ys(){this.i=null,this.g="",this.h=!1}var vs={},Yn={};function Zn(s,a,l){s.M=1,s.A=nn(le(a)),s.u=l,s.R=!0,_s(s,null)}function _s(s,a){s.F=Date.now(),tn(s),s.B=le(s.A);var l=s.B,u=s.S;Array.isArray(u)||(u=[String(u)]),Ns(l.i,"t",u),s.C=0,l=s.j.L,s.h=new ys,s.g=Js(s.j,l?a:null,!s.u),s.P>0&&(s.O=new ma(f(s.Y,s,s.g),s.P)),a=s.V,l=s.g,u=s.ba;var E="readystatechange";Array.isArray(E)||(E&&(ls[0]=E.toString()),E=ls);for(let C=0;C<E.length;C++){const k=ss(l,E[C],u||a.handleEvent,!1,a.h||a);if(!k)break;a.g[k.key]=k}a=s.J?ts(s.J):{},s.u?(s.v||(s.v="POST"),a["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,a)):(s.v="GET",s.g.ea(s.B,s.v,null,a)),_t(),wa(s.i,s.v,s.B,s.l,s.S,s.u)}Se.prototype.ba=function(s){s=s.target;const a=this.O;a&&ke(s)==3?a.j():this.Y(s)},Se.prototype.Y=function(s){try{if(s==this.g)e:{const M=ke(this.g),G=this.g.ya(),z=this.g.ca();if(!(M<3)&&(M!=3||this.g&&(this.h.h||this.g.la()||Fs(this.g)))){this.K||M!=4||G==7||(G==8||z<=0?_t(3):_t(2)),Qn(this);var a=this.g.ca();this.X=a;var l=Sa(this);if(this.o=a==200,ba(this.i,this.v,this.B,this.l,this.S,M,a),this.o){if(this.U&&!this.L){t:{if(this.g){var u,E=this.g;if((u=E.g?E.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(u)){var C=u;break t}}C=null}if(s=C)rt(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ei(this,s);else{this.o=!1,this.m=3,Z(12),je(this),It(this);break e}}if(this.R){s=!0;let K;for(;!this.K&&this.C<l.length;)if(K=Aa(this,l),K==Yn){M==4&&(this.m=4,Z(14),s=!1),rt(this.i,this.l,null,"[Incomplete Response]");break}else if(K==vs){this.m=4,Z(15),rt(this.i,this.l,l,"[Invalid Chunk]"),s=!1;break}else rt(this.i,this.l,K,null),ei(this,K);if(ws(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),M!=4||l.length!=0||this.h.h||(this.m=1,Z(16),s=!1),this.o=this.o&&s,!s)rt(this.i,this.l,l,"[Invalid Chunked Response]"),je(this),It(this);else if(l.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),ci(k),k.P=!0,Z(11))}}else rt(this.i,this.l,l,null),ei(this,l);M==4&&je(this),this.o&&!this.K&&(M==4?qs(this.j,this):(this.o=!1,tn(this)))}else ja(this.g),a==400&&l.indexOf("Unknown SID")>0?(this.m=3,Z(12)):(this.m=0,Z(13)),je(this),It(this)}}}catch{}finally{}};function Sa(s){if(!ws(s))return s.g.la();const a=Fs(s.g);if(a==="")return"";let l="";const u=a.length,E=ke(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return je(s),It(s),"";s.h.i=new c.TextDecoder}for(let C=0;C<u;C++)s.h.h=!0,l+=s.h.i.decode(a[C],{stream:!(E&&C==u-1)});return a.length=0,s.h.g+=l,s.C=0,s.h.g}function ws(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function Aa(s,a){var l=s.C,u=a.indexOf(`
`,l);return u==-1?Yn:(l=Number(a.substring(l,u)),isNaN(l)?vs:(u+=1,u+l>a.length?Yn:(a=a.slice(u,u+l),s.C=u+l,a)))}Se.prototype.cancel=function(){this.K=!0,je(this)};function tn(s){s.T=Date.now()+s.H,bs(s,s.H)}function bs(s,a){if(s.D!=null)throw Error("WatchDog timer not null");s.D=wt(f(s.aa,s),a)}function Qn(s){s.D&&(c.clearTimeout(s.D),s.D=null)}Se.prototype.aa=function(){this.D=null;const s=Date.now();s-this.T>=0?(Ea(this.i,this.B),this.M!=2&&(_t(),Z(17)),je(this),this.m=2,It(this)):bs(this,this.T-s)};function It(s){s.j.I==0||s.K||qs(s.j,s)}function je(s){Qn(s);var a=s.O;a&&typeof a.dispose=="function"&&a.dispose(),s.O=null,hs(s.V),s.g&&(a=s.g,s.g=null,a.abort(),a.dispose())}function ei(s,a){try{var l=s.j;if(l.I!=0&&(l.g==s||ti(l.h,s))){if(!s.L&&ti(l.h,s)&&l.I==3){try{var u=l.Ba.g.parse(a)}catch{u=null}if(Array.isArray(u)&&u.length==3){var E=u;if(E[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<s.F)cn(l),on(l);else break e;ai(l),Z(18)}}else l.xa=E[1],0<l.xa-l.K&&E[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=wt(f(l.Va,l),6e3));Ts(l.h)<=1&&l.ta&&(l.ta=void 0)}else ze(l,11)}else if((s.L||l.g==s)&&cn(l),!m(a))for(E=l.Ba.g.parse(a),a=0;a<E.length;a++){let z=E[a];const K=z[0];if(!(K<=l.K))if(l.K=K,z=z[1],l.I==2)if(z[0]=="c"){l.M=z[1],l.ba=z[2];const he=z[3];he!=null&&(l.ka=he,l.j.info("VER="+l.ka));const We=z[4];We!=null&&(l.za=We,l.j.info("SVER="+l.za));const Pe=z[5];Pe!=null&&typeof Pe=="number"&&Pe>0&&(u=1.5*Pe,l.O=u,l.j.info("backChannelRequestTimeoutMs_="+u)),u=l;const De=s.g;if(De){const ln=De.g?De.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ln){var C=u.h;C.g||ln.indexOf("spdy")==-1&&ln.indexOf("quic")==-1&&ln.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(ni(C,C.h),C.h=null))}if(u.G){const li=De.g?De.g.getResponseHeader("X-HTTP-Session-Id"):null;li&&(u.wa=li,W(u.J,u.G,li))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-s.F,l.j.info("Handshake RTT: "+l.T+"ms")),u=l;var k=s;if(u.na=Xs(u,u.L?u.ba:null,u.W),k.L){Cs(u.h,k);var M=k,G=u.O;G&&(M.H=G),M.D&&(Qn(M),tn(M)),u.g=k}else Ws(u);l.i.length>0&&an(l)}else z[0]!="stop"&&z[0]!="close"||ze(l,7);else l.I==3&&(z[0]=="stop"||z[0]=="close"?z[0]=="stop"?ze(l,7):oi(l):z[0]!="noop"&&l.l&&l.l.qa(z),l.A=0)}}_t(4)}catch{}}var Ra=class{constructor(s,a){this.g=s,this.map=a}};function Es(s){this.l=s||10,c.PerformanceNavigationTiming?(s=c.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Is(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Ts(s){return s.h?1:s.g?s.g.size:0}function ti(s,a){return s.h?s.h==a:s.g?s.g.has(a):!1}function ni(s,a){s.g?s.g.add(a):s.h=a}function Cs(s,a){s.h&&s.h==a?s.h=null:s.g&&s.g.has(a)&&s.g.delete(a)}Es.prototype.cancel=function(){if(this.i=Ss(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const s of this.g.values())s.cancel();this.g.clear()}};function Ss(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let a=s.i;for(const l of s.g.values())a=a.concat(l.G);return a}return S(s.i)}var As=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ka(s,a){if(s){s=s.split("&");for(let l=0;l<s.length;l++){const u=s[l].indexOf("=");let E,C=null;u>=0?(E=s[l].substring(0,u),C=s[l].substring(u+1)):E=s[l],a(E,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function Ae(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let a;s instanceof Ae?(this.l=s.l,Tt(this,s.j),this.o=s.o,this.g=s.g,Ct(this,s.u),this.h=s.h,ii(this,Os(s.i)),this.m=s.m):s&&(a=String(s).match(As))?(this.l=!1,Tt(this,a[1]||"",!0),this.o=St(a[2]||""),this.g=St(a[3]||"",!0),Ct(this,a[4]),this.h=St(a[5]||"",!0),ii(this,a[6]||"",!0),this.m=St(a[7]||"")):(this.l=!1,this.i=new Rt(null,this.l))}Ae.prototype.toString=function(){const s=[];var a=this.j;a&&s.push(At(a,Rs,!0),":");var l=this.g;return(l||a=="file")&&(s.push("//"),(a=this.o)&&s.push(At(a,Rs,!0),"@"),s.push(Et(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&s.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(At(l,l.charAt(0)=="/"?Na:Da,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",At(l,La)),s.join("")},Ae.prototype.resolve=function(s){const a=le(this);let l=!!s.j;l?Tt(a,s.j):l=!!s.o,l?a.o=s.o:l=!!s.g,l?a.g=s.g:l=s.u!=null;var u=s.h;if(l)Ct(a,s.u);else if(l=!!s.h){if(u.charAt(0)!="/")if(this.g&&!this.h)u="/"+u;else{var E=a.h.lastIndexOf("/");E!=-1&&(u=a.h.slice(0,E+1)+u)}if(E=u,E==".."||E==".")u="";else if(E.indexOf("./")!=-1||E.indexOf("/.")!=-1){u=E.lastIndexOf("/",0)==0,E=E.split("/");const C=[];for(let k=0;k<E.length;){const M=E[k++];M=="."?u&&k==E.length&&C.push(""):M==".."?((C.length>1||C.length==1&&C[0]!="")&&C.pop(),u&&k==E.length&&C.push("")):(C.push(M),u=!0)}u=C.join("/")}else u=E}return l?a.h=u:l=s.i.toString()!=="",l?ii(a,Os(s.i)):l=!!s.m,l&&(a.m=s.m),a};function le(s){return new Ae(s)}function Tt(s,a,l){s.j=l?St(a,!0):a,s.j&&(s.j=s.j.replace(/:$/,""))}function Ct(s,a){if(a){if(a=Number(a),isNaN(a)||a<0)throw Error("Bad port number "+a);s.u=a}else s.u=null}function ii(s,a,l){a instanceof Rt?(s.i=a,xa(s.i,s.l)):(l||(a=At(a,Oa)),s.i=new Rt(a,s.l))}function W(s,a,l){s.i.set(a,l)}function nn(s){return W(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function St(s,a){return s?a?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function At(s,a,l){return typeof s=="string"?(s=encodeURI(s).replace(a,Pa),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Pa(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Rs=/[#\/\?@]/g,Da=/[#\?:]/g,Na=/[#\?]/g,Oa=/[#\?@]/g,La=/#/g;function Rt(s,a){this.h=this.g=null,this.i=s||null,this.j=!!a}function He(s){s.g||(s.g=new Map,s.h=0,s.i&&ka(s.i,function(a,l){s.add(decodeURIComponent(a.replace(/\+/g," ")),l)}))}i=Rt.prototype,i.add=function(s,a){He(this),this.i=null,s=ot(this,s);let l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(a),this.h+=1,this};function ks(s,a){He(s),a=ot(s,a),s.g.has(a)&&(s.i=null,s.h-=s.g.get(a).length,s.g.delete(a))}function Ps(s,a){return He(s),a=ot(s,a),s.g.has(a)}i.forEach=function(s,a){He(this),this.g.forEach(function(l,u){l.forEach(function(E){s.call(a,E,u,this)},this)},this)};function Ds(s,a){He(s);let l=[];if(typeof a=="string")Ps(s,a)&&(l=l.concat(s.g.get(ot(s,a))));else for(s=Array.from(s.g.values()),a=0;a<s.length;a++)l=l.concat(s[a]);return l}i.set=function(s,a){return He(this),this.i=null,s=ot(this,s),Ps(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[a]),this.h+=1,this},i.get=function(s,a){return s?(s=Ds(this,s),s.length>0?String(s[0]):a):a};function Ns(s,a,l){ks(s,a),l.length>0&&(s.i=null,s.g.set(ot(s,a),S(l)),s.h+=l.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const s=[],a=Array.from(this.g.keys());for(let u=0;u<a.length;u++){var l=a[u];const E=Et(l);l=Ds(this,l);for(let C=0;C<l.length;C++){let k=E;l[C]!==""&&(k+="="+Et(l[C])),s.push(k)}}return this.i=s.join("&")};function Os(s){const a=new Rt;return a.i=s.i,s.g&&(a.g=new Map(s.g),a.h=s.h),a}function ot(s,a){return a=String(a),s.j&&(a=a.toLowerCase()),a}function xa(s,a){a&&!s.j&&(He(s),s.i=null,s.g.forEach(function(l,u){const E=u.toLowerCase();u!=E&&(ks(this,u),Ns(this,E,l))},s)),s.j=a}function Ma(s,a){const l=new bt;if(c.Image){const u=new Image;u.onload=y(Re,l,"TestLoadImage: loaded",!0,a,u),u.onerror=y(Re,l,"TestLoadImage: error",!1,a,u),u.onabort=y(Re,l,"TestLoadImage: abort",!1,a,u),u.ontimeout=y(Re,l,"TestLoadImage: timeout",!1,a,u),c.setTimeout(function(){u.ontimeout&&u.ontimeout()},1e4),u.src=s}else a(!1)}function Ua(s,a){const l=new bt,u=new AbortController,E=setTimeout(()=>{u.abort(),Re(l,"TestPingServer: timeout",!1,a)},1e4);fetch(s,{signal:u.signal}).then(C=>{clearTimeout(E),C.ok?Re(l,"TestPingServer: ok",!0,a):Re(l,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(E),Re(l,"TestPingServer: error",!1,a)})}function Re(s,a,l,u,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),u(l)}catch{}}function Ba(){this.g=new va}function si(s){this.i=s.Sb||null,this.h=s.ab||!1}I(si,us),si.prototype.g=function(){return new sn(this.i,this.h)};function sn(s,a){J.call(this),this.H=s,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}I(sn,J),i=sn.prototype,i.open=function(s,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=a,this.readyState=1,Pt(this)},i.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const a={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(a.body=s),(this.H||c).fetch(new Request(this.D,a)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,kt(this)),this.readyState=0},i.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ls(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ls(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}i.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var a=s.value?s.value:new Uint8Array(0);(a=this.B.decode(a,{stream:!s.done}))&&(this.response=this.responseText+=a)}s.done?kt(this):Pt(this),this.readyState==3&&Ls(this)}},i.Oa=function(s){this.g&&(this.response=this.responseText=s,kt(this))},i.Na=function(s){this.g&&(this.response=s,kt(this))},i.ga=function(){this.g&&kt(this)};function kt(s){s.readyState=4,s.l=null,s.j=null,s.B=null,Pt(s)}i.setRequestHeader=function(s,a){this.A.append(s,a)},i.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const s=[],a=this.h.entries();for(var l=a.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=a.next();return s.join(`\r
`)};function Pt(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(sn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function xs(s){let a="";return Zt(s,function(l,u){a+=u,a+=":",a+=l,a+=`\r
`}),a}function ri(s,a,l){e:{for(u in l){var u=!1;break e}u=!0}u||(l=xs(l),typeof s=="string"?l!=null&&Et(l):W(s,a,l))}function $(s){J.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}I($,J);var Fa=/^https?$/i,Va=["POST","PUT"];i=$.prototype,i.Fa=function(s){this.H=s},i.ea=function(s,a,l,u){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);a=a?a.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ms.g(),this.g.onreadystatechange=T(f(this.Ca,this));try{this.B=!0,this.g.open(a,String(s),!0),this.B=!1}catch(C){Ms(this,C);return}if(s=l||"",l=new Map(this.headers),u)if(Object.getPrototypeOf(u)===Object.prototype)for(var E in u)l.set(E,u[E]);else if(typeof u.keys=="function"&&typeof u.get=="function")for(const C of u.keys())l.set(C,u.get(C));else throw Error("Unknown input type for opt_headers: "+String(u));u=Array.from(l.keys()).find(C=>C.toLowerCase()=="content-type"),E=c.FormData&&s instanceof c.FormData,!(Array.prototype.indexOf.call(Va,a,void 0)>=0)||u||E||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,k]of l)this.g.setRequestHeader(C,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(C){Ms(this,C)}};function Ms(s,a){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=a,s.o=5,Us(s),rn(s)}function Us(s){s.A||(s.A=!0,Y(s,"complete"),Y(s,"error"))}i.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,Y(this,"complete"),Y(this,"abort"),rn(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),rn(this,!0)),$.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?Bs(this):this.Xa())},i.Xa=function(){Bs(this)};function Bs(s){if(s.h&&typeof o<"u"){if(s.v&&ke(s)==4)setTimeout(s.Ca.bind(s),0);else if(Y(s,"readystatechange"),ke(s)==4){s.h=!1;try{const C=s.ca();e:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}var l;if(!(l=a)){var u;if(u=C===0){let k=String(s.D).match(As)[1]||null;!k&&c.self&&c.self.location&&(k=c.self.location.protocol.slice(0,-1)),u=!Fa.test(k?k.toLowerCase():"")}l=u}if(l)Y(s,"complete"),Y(s,"success");else{s.o=6;try{var E=ke(s)>2?s.g.statusText:""}catch{E=""}s.l=E+" ["+s.ca()+"]",Us(s)}}finally{rn(s)}}}}function rn(s,a){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);const l=s.g;s.g=null,a||Y(s,"ready");try{l.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function ke(s){return s.g?s.g.readyState:0}i.ca=function(){try{return ke(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(s){if(this.g){var a=this.g.responseText;return s&&a.indexOf(s)==0&&(a=a.substring(s.length)),ya(a)}};function Fs(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function ja(s){const a={};s=(s.g&&ke(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let u=0;u<s.length;u++){if(m(s[u]))continue;var l=Ca(s[u]);const E=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const C=a[E]||[];a[E]=C,C.push(l)}ua(a,function(u){return u.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Dt(s,a,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||a}function Vs(s){this.za=0,this.i=[],this.j=new bt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Dt("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Dt("baseRetryDelayMs",5e3,s),this.Za=Dt("retryDelaySeedMs",1e4,s),this.Ta=Dt("forwardChannelMaxRetries",2,s),this.va=Dt("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new Es(s&&s.concurrentRequestLimit),this.Ba=new Ba,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=Vs.prototype,i.ka=8,i.I=1,i.connect=function(s,a,l,u){Z(0),this.W=s,this.H=a||{},l&&u!==void 0&&(this.H.OSID=l,this.H.OAID=u),this.F=this.X,this.J=Xs(this,null,this.W),an(this)};function oi(s){if(js(s),s.I==3){var a=s.V++,l=le(s.J);if(W(l,"SID",s.M),W(l,"RID",a),W(l,"TYPE","terminate"),Nt(s,l),a=new Se(s,s.j,a),a.M=2,a.A=nn(le(l)),l=!1,c.navigator&&c.navigator.sendBeacon)try{l=c.navigator.sendBeacon(a.A.toString(),"")}catch{}!l&&c.Image&&(new Image().src=a.A,l=!0),l||(a.g=Js(a.j,null),a.g.ea(a.A)),a.F=Date.now(),tn(a)}Ks(s)}function on(s){s.g&&(ci(s),s.g.cancel(),s.g=null)}function js(s){on(s),s.v&&(c.clearTimeout(s.v),s.v=null),cn(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&c.clearTimeout(s.m),s.m=null)}function an(s){if(!Is(s.h)&&!s.m){s.m=!0;var a=s.Ea;O||p(),N||(O(),N=!0),v.add(a,s),s.D=0}}function Ha(s,a){return Ts(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=a.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=wt(f(s.Ea,s,a),Gs(s,s.D)),s.D++,!0)}i.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;const E=new Se(this,this.j,s);let C=this.o;if(this.U&&(C?(C=ts(C),is(C,this.U)):C=this.U),this.u!==null||this.R||(E.J=C,C=null),this.S)e:{for(var a=0,l=0;l<this.i.length;l++){t:{var u=this.i[l];if("__data__"in u.map&&(u=u.map.__data__,typeof u=="string")){u=u.length;break t}u=void 0}if(u===void 0)break;if(a+=u,a>4096){a=l;break e}if(a===4096||l===this.i.length-1){a=l+1;break e}}a=1e3}else a=1e3;a=zs(this,E,a),l=le(this.J),W(l,"RID",s),W(l,"CVER",22),this.G&&W(l,"X-HTTP-Session-Id",this.G),Nt(this,l),C&&(this.R?a="headers="+Et(xs(C))+"&"+a:this.u&&ri(l,this.u,C)),ni(this.h,E),this.Ra&&W(l,"TYPE","init"),this.S?(W(l,"$req",a),W(l,"SID","null"),E.U=!0,Zn(E,l,null)):Zn(E,l,a),this.I=2}}else this.I==3&&(s?Hs(this,s):this.i.length==0||Is(this.h)||Hs(this))};function Hs(s,a){var l;a?l=a.l:l=s.V++;const u=le(s.J);W(u,"SID",s.M),W(u,"RID",l),W(u,"AID",s.K),Nt(s,u),s.u&&s.o&&ri(u,s.u,s.o),l=new Se(s,s.j,l,s.D+1),s.u===null&&(l.J=s.o),a&&(s.i=a.G.concat(s.i)),a=zs(s,l,1e3),l.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),ni(s.h,l),Zn(l,u,a)}function Nt(s,a){s.H&&Zt(s.H,function(l,u){W(a,u,l)}),s.l&&Zt({},function(l,u){W(a,u,l)})}function zs(s,a,l){l=Math.min(s.i.length,l);const u=s.l?f(s.l.Ka,s.l,s):null;e:{var E=s.i;let M=-1;for(;;){const G=["count="+l];M==-1?l>0?(M=E[0].g,G.push("ofs="+M)):M=0:G.push("ofs="+M);let z=!0;for(let K=0;K<l;K++){var C=E[K].g;const he=E[K].map;if(C-=M,C<0)M=Math.max(0,E[K].g-100),z=!1;else try{C="req"+C+"_"||"";try{var k=he instanceof Map?he:Object.entries(he);for(const[We,Pe]of k){let De=Pe;h(Pe)&&(De=$n(Pe)),G.push(C+We+"="+encodeURIComponent(De))}}catch(We){throw G.push(C+"type="+encodeURIComponent("_badmap")),We}}catch{u&&u(he)}}if(z){k=G.join("&");break e}}k=void 0}return s=s.i.splice(0,l),a.G=s,k}function Ws(s){if(!s.g&&!s.v){s.Y=1;var a=s.Da;O||p(),N||(O(),N=!0),v.add(a,s),s.A=0}}function ai(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=wt(f(s.Da,s),Gs(s,s.A)),s.A++,!0)}i.Da=function(){if(this.v=null,$s(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=wt(f(this.Wa,this),s)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Z(10),on(this),$s(this))};function ci(s){s.B!=null&&(c.clearTimeout(s.B),s.B=null)}function $s(s){s.g=new Se(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var a=le(s.na);W(a,"RID","rpc"),W(a,"SID",s.M),W(a,"AID",s.K),W(a,"CI",s.F?"0":"1"),!s.F&&s.ia&&W(a,"TO",s.ia),W(a,"TYPE","xmlhttp"),Nt(s,a),s.u&&s.o&&ri(a,s.u,s.o),s.O&&(s.g.H=s.O);var l=s.g;s=s.ba,l.M=1,l.A=nn(le(a)),l.u=null,l.R=!0,_s(l,s)}i.Va=function(){this.C!=null&&(this.C=null,on(this),ai(this),Z(19))};function cn(s){s.C!=null&&(c.clearTimeout(s.C),s.C=null)}function qs(s,a){var l=null;if(s.g==a){cn(s),ci(s),s.g=null;var u=2}else if(ti(s.h,a))l=a.G,Cs(s.h,a),u=1;else return;if(s.I!=0){if(a.o)if(u==1){l=a.u?a.u.length:0,a=Date.now()-a.F;var E=s.D;u=Kn(),Y(u,new gs(u,l)),an(s)}else Ws(s);else if(E=a.m,E==3||E==0&&a.X>0||!(u==1&&Ha(s,a)||u==2&&ai(s)))switch(l&&l.length>0&&(a=s.h,a.i=a.i.concat(l)),E){case 1:ze(s,5);break;case 4:ze(s,10);break;case 3:ze(s,6);break;default:ze(s,2)}}}function Gs(s,a){let l=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(l*=2),l*a}function ze(s,a){if(s.j.info("Error code "+a),a==2){var l=f(s.bb,s),u=s.Ua;const E=!u;u=new Ae(u||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Tt(u,"https"),nn(u),E?Ma(u.toString(),l):Ua(u.toString(),l)}else Z(2);s.I=0,s.l&&s.l.pa(a),Ks(s),js(s)}i.bb=function(s){s?(this.j.info("Successfully pinged google.com"),Z(2)):(this.j.info("Failed to ping google.com"),Z(1))};function Ks(s){if(s.I=0,s.ja=[],s.l){const a=Ss(s.h);(a.length!=0||s.i.length!=0)&&(A(s.ja,a),A(s.ja,s.i),s.h.i.length=0,S(s.i),s.i.length=0),s.l.oa()}}function Xs(s,a,l){var u=l instanceof Ae?le(l):new Ae(l);if(u.g!="")a&&(u.g=a+"."+u.g),Ct(u,u.u);else{var E=c.location;u=E.protocol,a=a?a+"."+E.hostname:E.hostname,E=+E.port;const C=new Ae(null);u&&Tt(C,u),a&&(C.g=a),E&&Ct(C,E),l&&(C.h=l),u=C}return l=s.G,a=s.wa,l&&a&&W(u,l,a),W(u,"VER",s.ka),Nt(s,u),u}function Js(s,a,l){if(a&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return a=s.Aa&&!s.ma?new $(new si({ab:l})):new $(s.ma),a.Fa(s.L),a}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ys(){}i=Ys.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function ne(s,a){J.call(this),this.g=new Vs(a),this.l=s,this.h=a&&a.messageUrlParams||null,s=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(s?s["X-WebChannel-Content-Type"]=a.messageContentType:s={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.sa&&(s?s["X-WebChannel-Client-Profile"]=a.sa:s={"X-WebChannel-Client-Profile":a.sa}),this.g.U=s,(s=a&&a.Qb)&&!m(s)&&(this.g.u=s),this.A=a&&a.supportsCrossDomainXhr||!1,this.v=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!m(a)&&(this.g.G=a,s=this.h,s!==null&&a in s&&(s=this.h,a in s&&delete s[a])),this.j=new at(this)}I(ne,J),ne.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ne.prototype.close=function(){oi(this.g)},ne.prototype.o=function(s){var a=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.v&&(l={},l.__data__=$n(s),s=l);a.i.push(new Ra(a.Ya++,s)),a.I==3&&an(a)},ne.prototype.N=function(){this.g.l=null,delete this.j,oi(this.g),delete this.g,ne.Z.N.call(this)};function Zs(s){qn.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var a=s.__sm__;if(a){e:{for(const l in a){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,a=a!==null&&s in a?a[s]:void 0),this.data=a}else this.data=s}I(Zs,qn);function Qs(){Gn.call(this),this.status=1}I(Qs,Gn);function at(s){this.g=s}I(at,Ys),at.prototype.ra=function(){Y(this.g,"a")},at.prototype.qa=function(s){Y(this.g,new Zs(s))},at.prototype.pa=function(s){Y(this.g,new Qs)},at.prototype.oa=function(){Y(this.g,"b")},ne.prototype.send=ne.prototype.o,ne.prototype.open=ne.prototype.m,ne.prototype.close=ne.prototype.close,Xn.NO_ERROR=0,Xn.TIMEOUT=8,Xn.HTTP_ERROR=6,Ta.COMPLETE="complete",_a.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",J.prototype.listen=J.prototype.J,$.prototype.listenOnce=$.prototype.K,$.prototype.getLastError=$.prototype.Ha,$.prototype.getLastErrorCode=$.prototype.ya,$.prototype.getStatus=$.prototype.ca,$.prototype.getResponseJson=$.prototype.La,$.prototype.getResponseText=$.prototype.la,$.prototype.send=$.prototype.ea,$.prototype.setWithCredentials=$.prototype.Fa}).apply(typeof dn<"u"?dn:typeof self<"u"?self:typeof window<"u"?window:{});const Ur="@firebase/firestore",Br="4.9.2";class Q{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Q.UNAUTHENTICATED=new Q(null),Q.GOOGLE_CREDENTIALS=new Q("google-credentials-uid"),Q.FIRST_PARTY=new Q("first-party-uid"),Q.MOCK_USER=new Q("mock-user");let Xt="12.3.0";const pt=new Ui("@firebase/firestore");function oe(i,...e){if(pt.logLevel<=H.DEBUG){const t=e.map(Ji);pt.debug(`Firestore (${Xt}): ${i}`,...t)}}function ea(i,...e){if(pt.logLevel<=H.ERROR){const t=e.map(Ji);pt.error(`Firestore (${Xt}): ${i}`,...t)}}function Ku(i,...e){if(pt.logLevel<=H.WARN){const t=e.map(Ji);pt.warn(`Firestore (${Xt}): ${i}`,...t)}}function Ji(i){if(typeof i=="string")return i;try{return(function(t){return JSON.stringify(t)})(i)}catch{return i}}function Ht(i,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,ta(i,n,t)}function ta(i,e,t){let n=`FIRESTORE (${Xt}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ea(n),new Error(n)}function Mt(i,e,t,n){let r="Unexpected state";typeof t=="string"?r=t:n=t,i||ta(e,r,n)}const V={CANCELLED:"cancelled",INVALID_ARGUMENT:"invalid-argument",FAILED_PRECONDITION:"failed-precondition"};class j extends ve{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ut{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class na{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Xu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Q.UNAUTHENTICATED)))}shutdown(){}}class Ju{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Yu{constructor(e){this.t=e,this.currentUser=Q.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Mt(this.o===void 0,42304);let n=this.i;const r=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let o=new Ut;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ut,e.enqueueRetryable((()=>r(this.currentUser)))};const c=()=>{const d=o;e.enqueueRetryable((async()=>{await d.promise,await r(this.currentUser)}))},h=d=>{oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((d=>h(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?h(d):(oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ut)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Mt(typeof n.accessToken=="string",31837,{l:n}),new na(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Mt(e===null||typeof e=="string",2055,{h:e}),new Q(e)}}class Zu{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Q.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Qu{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Zu(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Q.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Fr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ed{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,se(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Mt(this.o===void 0,3512);const n=o=>{o.error!=null&&oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const c=o.token!==this.m;return this.m=o.token,oe("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>n(o)))};const r=o=>{oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>r(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Fr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Mt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Fr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function td(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}class nd{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=td(40);for(let o=0;o<r.length;++o)n.length<20&&r[o]<t&&(n+=e.charAt(r[o]%62))}return n}}function Ve(i,e){return i<e?-1:i>e?1:0}function id(i,e){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++){const r=i.charAt(n),o=e.charAt(n);if(r!==o)return wi(r)===wi(o)?Ve(r,o):wi(r)?1:-1}return Ve(i.length,e.length)}const sd=55296,rd=57343;function wi(i){const e=i.charCodeAt(0);return e>=sd&&e<=rd}const Vr="__name__";class ue{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ht(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Ht(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ue.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ue?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const o=ue.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return Ve(e.length,t.length)}static compareSegments(e,t){const n=ue.isNumericId(e),r=ue.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ue.extractNumericId(e).compare(ue.extractNumericId(t)):id(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Xi.fromString(e.substring(4,e.length-2))}}class ie extends ue{construct(e,t,n){return new ie(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new j(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((r=>r.length>0)))}return new ie(t)}static emptyPath(){return new ie([])}}const od=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qe extends ue{construct(e,t,n){return new qe(e,t,n)}static isValidIdentifier(e){return od.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Vr}static keyField(){return new qe([Vr])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(n.length===0)throw new j(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let c=!1;for(;r<e.length;){const h=e[r];if(h==="\\"){if(r+1===e.length)throw new j(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[r+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new j(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,r+=2}else h==="`"?(c=!c,r++):h!=="."||c?(n+=h,r++):(o(),r++)}if(o(),c)throw new j(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qe(t)}static emptyPath(){return new qe([])}}class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(ie.fromString(e))}static fromName(e){return new Ge(ie.fromString(e).popFirst(5))}static empty(){return new Ge(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new ie(e.slice()))}}function ad(i,e,t,n){if(e===!0&&n===!0)throw new j(V.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function cd(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function ld(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Ht(12329,{type:typeof i})}function hd(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new j(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ld(i);throw new j(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function q(i,e){const t={typeString:i};return e&&(t.value=e),t}function Jt(i,e){if(!cd(i))throw new j(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const r=e[n].typeString,o="value"in e[n]?{value:e[n].value}:void 0;if(!(n in i)){t=`JSON missing required field: '${n}'`;break}const c=i[n];if(r&&typeof c!==r){t=`JSON field '${n}' must be a ${r}.`;break}if(o!==void 0&&c!==o.value){t=`Expected '${n}' field to equal '${o.value}'`;break}}if(t)throw new j(V.INVALID_ARGUMENT,t);return!0}const jr=-62135596800,Hr=1e6;class de{static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Hr);return new de(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new j(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new j(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jr)throw new j(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new j(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hr}_compareTo(e){return this.seconds===e.seconds?Ve(this.nanoseconds,e.nanoseconds):Ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:de._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Jt(e,de._jsonSchema))return new de(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-jr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}de._jsonSchemaVersion="firestore/timestamp/1.0",de._jsonSchema={type:q("string",de._jsonSchemaVersion),seconds:q("number"),nanoseconds:q("number")};function ud(i){return i.name==="IndexedDbTransactionError"}class dd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class et{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new dd("Invalid base64 string: "+o):o}})(e);return new et(t)}static fromUint8Array(e){const t=(function(r){let o="";for(let c=0;c<r.length;++c)o+=String.fromCharCode(r[c]);return o})(e);return new et(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}et.EMPTY_BYTE_STRING=new et("");const Ni="(default)";class Dn{constructor(e,t){this.projectId=e,this.database=t||Ni}static empty(){return new Dn("","")}get isDefaultDatabase(){return this.database===Ni}isEqual(e){return e instanceof Dn&&e.projectId===this.projectId&&e.database===this.database}}class fd{constructor(e,t=null,n=[],r=[],o=null,c="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=o,this.limitType=c,this.startAt=h,this.endAt=d,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function pd(i){return new fd(i)}var zr,F;(F=zr||(zr={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";new Xi([4294967295,4294967295],0);const gd=41943040;const md=1048576;function bi(){return typeof document<"u"?document:null}class yd{constructor(e,t,n=1e3,r=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&oe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}class Yi{constructor(e,t,n,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=o,this.deferred=new Ut,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,o){const c=Date.now()+n,h=new Yi(e,t,c,r,o);return h.start(n),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new j(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var Wr,$r;($r=Wr||(Wr={})).Ma="default",$r.Cache="cache";function vd(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}const qr=new Map;const ia="firestore.googleapis.com",Gr=!0;class Kr{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new j(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ia,this.ssl=Gr}else this.host=e.host,this.ssl=e.ssl??Gr;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=gd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<md)throw new j(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ad("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vd(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,r){return n.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sa{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Kr({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new j(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new j(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Kr(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Xu;switch(n.type){case"firstParty":return new Qu(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new j(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=qr.get(t);n&&(oe("ComponentProvider","Removing Datastore"),qr.delete(t),n.terminate())})(this),Promise.resolve()}}function _d(i,e,t,n={}){i=hd(i,sa);const r=gt(e),o=i._getSettings(),c={...o,emulatorOptions:i._getEmulatorOptions()},h=`${e}:${t}`;r&&(xi(`https://${h}`),Mi("Firestore",!0)),o.host!==ia&&o.host!==h&&Ku("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...o,host:h,ssl:r,emulatorOptions:n};if(!Ye(d,c)&&(i._setSettings(d),n.mockUserToken)){let f,y;if(typeof n.mockUserToken=="string")f=n.mockUserToken,y=Q.MOCK_USER;else{f=yo(n.mockUserToken,i._app?.options.projectId);const I=n.mockUserToken.sub||n.mockUserToken.user_id;if(!I)throw new j(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new Q(I)}i._authCredentials=new Ju(new na(f,y))}}class Zi{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Zi(this.firestore,e,this._query)}}class fe{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fe(this.firestore,e,this._key)}toJSON(){return{type:fe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Jt(t,fe._jsonSchema))return new fe(e,n||null,new Ge(ie.fromString(t.referencePath)))}}fe._jsonSchemaVersion="firestore/documentReference/1.0",fe._jsonSchema={type:q("string",fe._jsonSchemaVersion),referencePath:q("string")};class Qi extends Zi{constructor(e,t,n){super(e,t,pd(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fe(this.firestore,null,new Ge(e))}withConverter(e){return new Qi(this.firestore,e,this._path)}}const Xr="AsyncQueue";class Jr{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new yd(this,"async_queue_retry"),this._c=()=>{const n=bi();n&&oe(Xr,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=bi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=bi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ut;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ud(e))throw e;oe(Xr,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,ea("INTERNAL UNHANDLED ERROR: ",Yr(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Yi.createAndSchedule(this,e,t,n,(o=>this.hc(o)));return this.tc.push(r),r}uc(){this.nc&&Ht(47125,{Pc:Yr(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Yr(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}class wd extends sa{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Jr,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Jr(e),this._firestoreClient=void 0,await e}}}function bd(i,e){const t=typeof i=="object"?i:Fi(),n=typeof i=="string"?i:Ni,r=Ln(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const o=po("firestore");o&&_d(r,...o)}return r}class we{constructor(e){this._byteString=e}static fromBase64String(e){try{return new we(et.fromBase64String(e))}catch(t){throw new j(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new we(et.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:we._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Jt(e,we._jsonSchema))return we.fromBase64String(e.bytes)}}we._jsonSchemaVersion="firestore/bytes/1.0",we._jsonSchema={type:q("string",we._jsonSchemaVersion),bytes:q("string")};class ra{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new j(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Xe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new j(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new j(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ve(this._lat,e._lat)||Ve(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xe._jsonSchemaVersion}}static fromJSON(e){if(Jt(e,Xe._jsonSchema))return new Xe(e.latitude,e.longitude)}}Xe._jsonSchemaVersion="firestore/geoPoint/1.0",Xe._jsonSchema={type:q("string",Xe._jsonSchemaVersion),latitude:q("number"),longitude:q("number")};class Je{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,r){if(n.length!==r.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==r[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Je._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Jt(e,Je._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Je(e.vectorValues);throw new j(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Je._jsonSchemaVersion="firestore/vectorValue/1.0",Je._jsonSchema={type:q("string",Je._jsonSchemaVersion),vectorValues:q("object")};const Ed=new RegExp("[~\\*/\\[\\]]");function Id(i,e,t){if(e.search(Ed)>=0)throw Zr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i);try{return new ra(...e.split("."))._internalPath}catch{throw Zr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i)}}function Zr(i,e,t,n,r){let o=`Function ${e}() called with invalid data`;o+=". ";let c="";return new j(V.INVALID_ARGUMENT,o+i+c)}class oa{constructor(e,t,n,r,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new fe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Td(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(aa("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Td extends oa{data(){return super.data()}}function aa(i,e){return typeof e=="string"?Id(i,e):e instanceof ra?e._internalPath:e._delegate._internalPath}class fn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dt extends oa{constructor(e,t,n,r,o,c){super(e,t,n,r,c),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new En(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(aa("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new j(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=dt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}dt._jsonSchemaVersion="firestore/documentSnapshot/1.0",dt._jsonSchema={type:q("string",dt._jsonSchemaVersion),bundleSource:q("string","DocumentSnapshot"),bundleName:q("string"),bundle:q("string")};class En extends dt{data(e={}){return super.data(e)}}class Bt{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fn(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new En(this._firestore,this._userDataWriter,n.key,n,new fn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new j(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,o){if(r._snapshot.oldDocs.isEmpty()){let c=0;return r._snapshot.docChanges.map((h=>{const d=new En(r._firestore,r._userDataWriter,h.doc.key,h.doc,new fn(r._snapshot.mutatedKeys.has(h.doc.key),r._snapshot.fromCache),r.query.converter);return h.doc,{type:"added",doc:d,oldIndex:-1,newIndex:c++}}))}{let c=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((h=>o||h.type!==3)).map((h=>{const d=new En(r._firestore,r._userDataWriter,h.doc.key,h.doc,new fn(r._snapshot.mutatedKeys.has(h.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,y=-1;return h.type!==0&&(f=c.indexOf(h.doc.key),c=c.delete(h.doc.key)),h.type!==1&&(c=c.add(h.doc),y=c.indexOf(h.doc.key)),{type:Cd(h.type),doc:d,oldIndex:f,newIndex:y}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new j(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Bt._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=nd.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),n.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Cd(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ht(61501,{type:i})}}Bt._jsonSchemaVersion="firestore/querySnapshot/1.0",Bt._jsonSchema={type:q("string",Bt._jsonSchemaVersion),bundleSource:q("string","QuerySnapshot"),bundleName:q("string"),bundle:q("string")};(function(e,t=!0){(function(r){Xt=r})(nt),Ze(new Fe("firestore",((n,{instanceIdentifier:r,options:o})=>{const c=n.getProvider("app").getImmediate(),h=new wd(new Yu(n.getProvider("auth-internal")),new ed(c,n.getProvider("app-check-internal")),(function(f,y){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new j(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dn(f.options.projectId,y)})(c,r),c);return o={useFetchStreams:t,...o},h._setSettings(o),h}),"PUBLIC").setMultipleInstances(!0)),pe(Ur,Br,e),pe(Ur,Br,"esm2020")})();const ca="firebasestorage.googleapis.com",Sd="storageBucket",Ad=120*1e3,Rd=600*1e3;class _e extends ve{constructor(e,t,n=0){super(Ei(e),`Firebase Storage: ${t} (${Ei(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_e.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ei(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ye;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ye||(ye={}));function Ei(i){return"storage/"+i}function kd(){const i="An unknown error occurred, please check the error payload for server response.";return new _e(ye.UNKNOWN,i)}function Pd(){return new _e(ye.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Dd(){return new _e(ye.CANCELED,"User canceled the upload/download.")}function Nd(i){return new _e(ye.INVALID_URL,"Invalid URL '"+i+"'.")}function Od(i){return new _e(ye.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function Qr(i){return new _e(ye.INVALID_ARGUMENT,i)}function la(){return new _e(ye.APP_DELETED,"The Firebase app was deleted.")}function Ld(i){return new _e(ye.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class ae{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ae.makeFromUrl(e,t)}catch{return new ae(e,"")}if(n.path==="")return n;throw Od(e)}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";function o(B){B.path.charAt(B.path.length-1)==="/"&&(B.path_=B.path_.slice(0,-1))}const c="(/(.*))?$",h=new RegExp("^gs://"+r+c,"i"),d={bucket:1,path:3};function f(B){B.path_=decodeURIComponent(B.path)}const y="v[A-Za-z0-9_]+",I=t.replace(/[.]/g,"\\."),T="(/([^?#]*).*)?$",S=new RegExp(`^https?://${I}/${y}/b/${r}/o${T}`,"i"),A={bucket:1,path:3},P=t===ca?"(?:storage.googleapis.com|storage.cloud.google.com)":t,R="([^?#]*)",D=new RegExp(`^https?://${P}/${r}/${R}`,"i"),U=[{regex:h,indices:d,postModify:o},{regex:S,indices:A,postModify:f},{regex:D,indices:{bucket:1,path:2},postModify:f}];for(let B=0;B<U.length;B++){const O=U[B],N=O.regex.exec(e);if(N){const v=N[O.indices.bucket];let p=N[O.indices.path];p||(p=""),n=new ae(v,p),O.postModify(n);break}}if(n==null)throw Nd(e);return n}}class xd{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Md(i,e,t){let n=1,r=null,o=null,c=!1,h=0;function d(){return h===2}let f=!1;function y(...R){f||(f=!0,e.apply(null,R))}function I(R){r=setTimeout(()=>{r=null,i(S,d())},R)}function T(){o&&clearTimeout(o)}function S(R,...D){if(f){T();return}if(R){T(),y.call(null,R,...D);return}if(d()||c){T(),y.call(null,R,...D);return}n<64&&(n*=2);let U;h===1?(h=2,U=0):U=(n+Math.random())*1e3,I(U)}let A=!1;function P(R){A||(A=!0,T(),!f&&(r!==null?(R||(h=2),clearTimeout(r),I(0)):R||(h=1)))}return I(0),o=setTimeout(()=>{c=!0,P(!0)},t),P}function Ud(i){i(!1)}function Bd(i){return i!==void 0}function eo(i,e,t,n){if(n<e)throw Qr(`Invalid value for '${i}'. Expected ${e} or greater.`);if(n>t)throw Qr(`Invalid value for '${i}'. Expected ${t} or less.`)}function Fd(i){const e=encodeURIComponent;let t="?";for(const n in i)if(i.hasOwnProperty(n)){const r=e(n)+"="+e(i[n]);t=t+r+"&"}return t=t.slice(0,-1),t}var Nn;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(Nn||(Nn={}));function Vd(i,e){const t=i>=500&&i<600,r=[408,429].indexOf(i)!==-1,o=e.indexOf(i)!==-1;return t||r||o}class jd{constructor(e,t,n,r,o,c,h,d,f,y,I,T=!0,S=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=c,this.callback_=h,this.errorCallback_=d,this.timeout_=f,this.progressCallback_=y,this.connectionFactory_=I,this.retry=T,this.isUsingEmulator=S,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((A,P)=>{this.resolve_=A,this.reject_=P,this.start_()})}start_(){const e=(n,r)=>{if(r){n(!1,new pn(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const c=h=>{const d=h.loaded,f=h.lengthComputable?h.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,f)};this.progressCallback_!==null&&o.addUploadProgressListener(c),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(c),this.pendingConnection_=null;const h=o.getErrorCode()===Nn.NO_ERROR,d=o.getStatus();if(!h||Vd(d,this.additionalRetryCodes_)&&this.retry){const y=o.getErrorCode()===Nn.ABORT;n(!1,new pn(!1,null,y));return}const f=this.successCodes_.indexOf(d)!==-1;n(!0,new pn(f,o))})},t=(n,r)=>{const o=this.resolve_,c=this.reject_,h=r.connection;if(r.wasSuccessCode)try{const d=this.callback_(h,h.getResponse());Bd(d)?o(d):o()}catch(d){c(d)}else if(h!==null){const d=kd();d.serverResponse=h.getErrorText(),this.errorCallback_?c(this.errorCallback_(h,d)):c(d)}else if(r.canceled){const d=this.appDelete_?la():Dd();c(d)}else{const d=Pd();c(d)}};this.canceled_?t(!1,new pn(!1,null,!0)):this.backoffId_=Md(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Ud(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class pn{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Hd(i,e){e!==null&&e.length>0&&(i.Authorization="Firebase "+e)}function zd(i,e){i["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Wd(i,e){e&&(i["X-Firebase-GMPID"]=e)}function $d(i,e){e!==null&&(i["X-Firebase-AppCheck"]=e)}function qd(i,e,t,n,r,o,c=!0,h=!1){const d=Fd(i.urlParams),f=i.url+d,y=Object.assign({},i.headers);return Wd(y,e),Hd(y,t),zd(y,o),$d(y,n),new jd(f,i.method,y,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,r,c,h)}function Gd(i){if(i.length===0)return null;const e=i.lastIndexOf("/");return e===-1?"":i.slice(0,e)}function Kd(i){const e=i.lastIndexOf("/",i.length-2);return e===-1?i:i.slice(e+1)}class On{constructor(e,t){this._service=e,t instanceof ae?this._location=t:this._location=ae.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new On(e,t)}get root(){const e=new ae(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Kd(this._location.path)}get storage(){return this._service}get parent(){const e=Gd(this._location.path);if(e===null)return null;const t=new ae(this._location.bucket,e);return new On(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Ld(e)}}function to(i,e){const t=e?.[Sd];return t==null?null:ae.makeFromBucketSpec(t,i)}function Xd(i,e,t,n={}){i.host=`${e}:${t}`;const r=gt(e);r&&(xi(`https://${i.host}/b`),Mi("Storage",!0)),i._isUsingEmulator=!0,i._protocol=r?"https":"http";const{mockUserToken:o}=n;o&&(i._overrideAuthToken=typeof o=="string"?o:yo(o,i.app.options.projectId))}class Jd{constructor(e,t,n,r,o,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=o,this._isUsingEmulator=c,this._bucket=null,this._host=ca,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Ad,this._maxUploadRetryTime=Rd,this._requests=new Set,r!=null?this._bucket=ae.makeFromBucketSpec(r,this._host):this._bucket=to(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=ae.makeFromBucketSpec(this._url,e):this._bucket=to(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){eo("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){eo("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(se(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new On(this,e)}_makeRequest(e,t,n,r,o=!0){if(this._deleted)return new xd(la());{const c=qd(e,this._appId,n,r,t,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const no="@firebase/storage",io="0.14.0";const ha="storage";function Yd(i=Fi(),e){i=tt(i);const n=Ln(i,ha).getImmediate({identifier:e}),r=po("storage");return r&&Zd(n,...r),n}function Zd(i,e,t,n={}){Xd(i,e,t,n)}function Qd(i,{instanceIdentifier:e}){const t=i.getProvider("app").getImmediate(),n=i.getProvider("auth-internal"),r=i.getProvider("app-check-internal");return new Jd(t,n,r,e,nt)}function ef(){Ze(new Fe(ha,Qd,"PUBLIC").setMultipleInstances(!0)),pe(no,io,""),pe(no,io,"esm2020")}ef();const tf={apiKey:"AIzaSyDUNSU2dhAsbcADx5emo-7NELyhv8CXpdI",authDomain:"sampler-8acd6.firebaseapp.com",projectId:"sampler-8acd6",storageBucket:"sampler-8acd6.firebasestorage.app",messagingSenderId:"316723858534",appId:"1:316723858534:web:bb8d08854c112206a2b1a7"},es=wo(tf);Wu(es);bd(es);Yd(es);let gn;async function nf(){ic(),gn=new pc;const i=async()=>{gn&&(await gn.initAudio(),console.log("Audio Context Unlocked:",gn.audioContext.state),window.removeEventListener("click",i))};window.addEventListener("click",i)}document.addEventListener("DOMContentLoaded",nf);
